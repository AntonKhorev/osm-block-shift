---
title: Мотивировочная часть
---

Допустим, вы редактируете какое-то место в городе. В данной записи будут рассматриваться именно городские условия, когда существуют кварталы, внутри которых находятся здания. Кварталы при этом разделяются относительно свободными от препятствий улицами. Допустим, что место, которое вы редактируете, находится на стороне улицы, на тротуаре, или не слишком глубоко внутри квартала. Именно к внешней стороне квартала обычно и привлечено большее внимание, так как она гораздо более доступна, и на ней находится большинство объектов, интересующих не только местных жителей. Также допустим, что здания и прочее содержимое квартала уже в значительной степени введены, и чем введённого больше, тем лучше это проиллюстрирует рассматриваемую ситуацию.

## Помехи для ввода

И вот вы хотите нарисовать что-то, находящееся рядом со зданием, в расположении чего вы уверены. Тут вы обнаруживаете, что сделать это вам мешает неправильное расположение уже добавленного в осм контура здания. Например, вы хотите провести линию тротуара, но выясняется, что она будет проходить через полигон здания. Или вы хотите отметить велопарковку у стены здания, но граница полигона здания оказывается достаточно далеко от места парковки. Что делать? Весьма вероятно, что первым решением, которое придёт вам в голову, будет подвинуть участок контура здания, обозначающий стену, на нужное вам место. К сожалению, часто это оказывается неправильным решением, так что не торопитесь его реализовывать.

Для начала стоит рассмотреть варианты, в меньшей степени затрагивающие существующие данные. Таким вариантом будет рисование нужного вам объекта не в абсолютно правильном месте, а в правильном относительно уже нарисованных зданий. Например, если вы рисуете по спутниковым снимкам, вы можете сдвинуть снимок так, чтобы здания на нём совпадали с уже введёнными, и рисовать объекты, находящиеся рядом, на или в зданиях по этому положению снимка, а для рисования того, что далеко, сдвинуть его обратно. Допустим, что вас этот вариант не устраивает, или что вы уже это сделали, а теперь хотите переместить нарисованное в истинное положение.

## Сдвиг стены

Теперь у вас либо снова появилось, либо так и осталось желание сдвинуть стену здания, выходящую на улицу. Сдвигать только одну стену - это, скорее всего, по-прежнему плохая идея. Иногда этого сделать просто нельзя. В зависимости от застройки и её отражения в осмовских данных, точки, между которыми находится интересующий вас отрезок стены, могут входить также и в другие объекты: примыкающие здания, заборы, газоны. В таких случаях сдвиг стены приведёт к искажению формы примыкающих объектов. Даже если точки и не входят в другие объекты, часто здания, заборы и прочее расположено на одной линии вдоль улицы, и сдвиг одной стены приведёт к неестественному выпиранию или вжатию здания по сравнению со всем остальным. Это осложнит жизнь тем, кто попытается изобразить что-то, находящееся между затрагиваемым зданием и прочими объектами, или даже лишь воспользоваться уже введёнными данными.

{% TODO %}скриншот: смежный "параллелограмм" - типичный признак того, что кто-то сдвинул стену здания отдельно{% endTODO %}

Особенно если речь идёт о рисовании тротуара, вы можете захотеть сдвинуть края всех объектов, идущих вдоль границы квартала, а не только стену одного здания. Так можно избежать видимого неестественного положения отдельного здания, но всех отрицательных последствий сдвига этим действием не устранить. Хоть вы и не поменяете форму края квартала в целом, вы исказите форму всех объектов, в которые входят как сдвигаемые, так и несдвигаемые точки. Например, при отодвигании края квартала вглубь, вы можете сделать здания существенно у́же, так как их задние стены останутся на месте.

{% TODO %}скриншот: дифф подрезки зданий{% endTODO %}

Да и сам сдвиг края квартала можно осуществлять по-разному. Можно сдвинуть все его точки одновременно в одном направлении на одинаковое расстояние, так искажений существующих данных будет меньше. К сожалению, большей популярностью пользуется другой способ: двигать каждую точку отдельно, вручную. При этом гораздо сложнее сохранить взаимное расположение точек. Часто этим расположением является нахождение на одной прямой, которое, ввиду его регулярности, очень легко нарушить. Разница между расположением чётко по прямой и отклонением от него обычно очень хорошо видна.

Конечно, выстраивание точек по прямой можно осуществить и после их ручного сдвига, но обычно этого не делают. Те, кто готовы это делать, также способны догадаться сдвигать точки одновременно, так как в обоих случаях понадобится их все выделить. Зато всё это могли сделать участники, редактировавшие геометрию квартала ранее, и их работа окажется подпорченной ручными сдвигами точек. Интересно, что участники, выполняющие ручные сдвиги, не стесняются называть этот процесс "выравниванием", хотя он скорее является искривлением. Значит, сделанное выше утверждение о том, что форма края квартала не поменяется, является не совсем верным. Эта форма при сдвигах отдельных точек очень даже может поменяться, хоть и не настолько существенно, как форма зданий.

Сдвиг стен, помимо точек на их линии, в существенной степени затрагивает также и точки рядом с ней. Ваше желание осуществить данный сдвиг могло объясняться необходимостью отметить что-то, положение чего должно быть правильным не только абсолютно, но и относительно стены. Подобным случаем является приведённый выше пример с велопарковкой. Тут надо сообразить, что с такой же необходимостью могли сталкиваться и ваши предшественники. Относительно стены и, в более общем случае, относительно здания могут уже быть отмечены различные объекты. При сдвиге стены надо было бы догадаться, что это за объекты и насколько следует их сдвинуть. Например, если рядом со стеной отмечена урна, её стоило бы сдвинуть на такое же расстояние, как и саму стену. Если внутри здания отмечена точка магазина, то её тоже, возможно, надо сдвинуть, хотя сложнее догадаться, насколько.

Конечно же, такую догадливость сдвигающие проявляют не всегда. При этом они не всегда догадываются даже до того, чтобы оставить то, что было внутри зданий, по-прежнему внутри, а то, что было снаружи - снаружи. То есть, на некоторые точки они просто не обращают внимания, даже если эти точки расположены очень близко к перемещаемым ими стенам, так близко, что их нереально не увидеть в окне редактора. Результатом этого являются, в частности, магазины, оказавшиеся за пределами зданий. Помимо получения странного расположения, эти магазины теряют адресную информацию. Теги {% tag "addr:*=*" %} обычно являются избыточными для магазинов, так как они уже есть на зданиях, и на точки магазинов эти теги часто не ставят. Со зданий адресная информация распространяется на всё их содержимое, пока это содержимое остаётся отмеченным внутри, что в нашем случае становится не так.

{% TODO %}скриншот: магазины вне зданий{% endTODO %}

## Влияние снимков

Двигание одних точек и игнорирование находящихся рядом с ними других типично для участников, уточняющих (по их мнению) геометрию по появившимся у них более качественным (по их мнению) снимкам. В этом случае уточнение может являться самоцелью, и тогда выполняющий его участник может не ограничиваться краями квартала, чтобы что-то к ним пририсовать. То есть, участник станет двигать объекты и в глубине квартала, включая те, о которых ему не может быть известно из доступных снимков. Серьёзной проблемой это станет, если такие объекты уже отмечены в значительной степени, то есть, если кто-то уже потратил время на исследование внутренностей квартала. После проделанных вновь пришедшим участником уточнений, его предшественнику придётся снова делать свои, если он это заметит и сможет восстановить разведанные на местности детали.

Особого упоминания заслуживают снимки с коптера, появление которых может вызвать волну уточнений от незнакомых с местностью участников. Во-первых, такие снимки охватывают ограниченную территорию, так что один край квартала или даже здания может быть виден, а другой - нет. Это не всегда останавливает желающих уточнять, и "уточнят" они только один край. Иногда "уточнение" состоит лишь из сдвига одной точки, придающего зигзагообразную форму тому, что ранее было прямым в данных и в реальности. К аналогичному результату можно прийти и противоположным путём: сдвинуть всё, кроме какой-то одной точки, а её забыть, случайно не выделить или проигнорировать, потому что она не видна на снимке.

Ещё у коптерных снимков могут быть свои локальные искажения. Рядом с качественным фрагментом изображения может быть такой, как будто по нему повозили инструментом "палец" в фотошопе. Тем не менее, большее разрешение этих снимков придаёт рисующим по ним уверенность, включая уверенность при обводке искажений. Результатом такой уверенности могут являться более круглые, чем в реальности, углы зданий. Даже когда искажений нет, рисователи по коптеру могут воспроизвести не форму зданий, а более широкую и неправильную форму крыш, карнизов и козырьков.[^2-hang] В общем, доступность коптерного снимка привлекает желающих рисовать то, что на нём видно, в том виде, в каком оно видно, не обращая внимания, как их правки повлияют на то, чего не видно.

[^2-hang]: Некоторые заявляют, что обводить козырьки надо, и они это осознанно делают. Это уже отдельная тема, хотя кое-что про "надо" мы ниже ещё скажем.

{% TODO %}скриншот у Рижского: Рискнёте ли вы обрисовывать эту стену? Некоторые рискуют.{% endTODO %}

## Сдвиг квартала целиком

Для того, чтобы избежать многих недостатков, связанных с изменением геометрии зданий, следует начинать это изменение со сдвига всего квартала целиком. Основная причина этого заключается в том, что явных и неявных связей *внутри* квартала больше, чем *между* кварталами. Я не говорю, что сдвига квартала окажется достаточно, и даже не говорю, что его удастся сделать, но по крайней мере рассмотреть этот вариант следует в первую очередь. Прочие корректировки можно применять уже после сдвига или после установления его нецелесообразности.

Намеченная выше последовательность действий позволяет поддерживать данные в наименее искажённом виде не только в конечном результате редактирования, но и на его протяжении. Это важно, так как помимо соображений о правильности результата надо учитывать то, что данные, которые возникла необходимость изменить, *уже* всем доступны, используются и, возможно, даже редактируются одновременно с вами. Слишком серьёзные изменения геометрии в не вполне правильную сторону создадут ситуацию, при которой разрешение [конфликтов редактирования](https://wiki.openstreetmap.org/wiki/Edit_conflict) будет затруднено.

**Основная цель рассматриваемых на протяжении этой записи операций - подготовить уже введённые данные к дальнейшим уточнениям и при этом их не испортить.** Испортить легче всего то, о чём нам неизвестно, в частности то, чего не видно на доступных снимках.

## Отказ от сдвига целиком

Правда, иногда во введённых данных портить нечего, так как никаких неизвестных деталей в них нет. Так бывает, например, когда ранее внутри квартала были нарисованы только контуры зданий, и сделано это было не слишком аккуратно, потому что основой этому послужили не слишком качественные снимки. В этом случае мы сами можем оказаться в рассмотренной выше ситуации как обладатели более качественных снимков, желающие по ним уточнить весь квартал. Тогда нам действительно может быть легче двигать и перерисовывать отдельные элементы контуров зданий, если мы готовы проделать это со всем кварталом. Или это может быть не легче, особенно если нам уже известны рассматриваемые далее методы сдвига квартала, но, по крайней мере, следовать этим методам уже не так важно, потому что нам просто нечего портить.

Чаще же от рассматриваемых методов приходится отказываться, если данные уже испорчены прибывшими ранее уточнятелями элементов по отдельности. Если мы не посчитаем целесообразным откатить их правки, нам будет сложно отделить затронутые элементы от незатронутых. Кроме того, затронутыми вероятно окажутся и те элементы, относительно исходного положения которых мы могли бы построить преобразование всего квартала целиком - наиболее продвинутый метод сдвига квартала, рассматриваемый в данной записи. В этой ситуации мы отказываемся от одновременного сдвига квартала, потому что ранее частично были сдвинуты отдельные его фрагменты. Сдвигавшие же отдельные фрагменты участники могли рассуждать точно так же: квартал не имеет смысла двигать целиком, потому что его фрагменты уже частично сдвинуты. Они могли быть правы, но весьма вероятно и то, что они не пытались проверить, были ли повреждены данные до их правок. В первую очередь и им, и нам следует смотреть на наличие невидимых на спутниковых снимках объектов типа арок и входов в здания. Если такие объекты в данных уже есть, от сдвига квартала целиком отказываться не стоит.

Подробнее различные необоснованные причины отказа от сдвига целиком мы рассмотрим в [следующей главе](../3-counter/). После этого мы перейдём к рассмотрению средств сдвига квартала и отдельных его этапов. Но если и мы откажемся от сдвига, в данной записи нас может заинтересовать [предпоследняя глава](../11-cleanup/). В ней описываются поправки, которые стоит выполнить после сдвига, но часть из них может пригодиться, даже если сдвига мы не делаем.
