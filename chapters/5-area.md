---
title: Определение области сдвига
---

Наша операция по сдвигу начинается с решения о том, что именно надо сдвигать. Мы, казалось бы, уже определились с областью сдвига: это квартал. Несмотря на это, у нас по прежнему может оставаться вопрос, где именно провести границу квартала. Насколько это существенный вопрос, зависит от того, что уже нарисовано. В самом простом случае на краю квартала нарисованы здания, и между ними и highway-линией улицы ничего больше нет. Тогда мы условно проведём границу области сдвига так, чтобы здания в неё вошли, а улица не вошла. Как провести границу реально, написано в [следующей главе](../6-select/). Конечно, возможен и ещё более простой случай, когда не нарисованы даже и здания, но тогда нам незачем действовать согласно данной записи.

Что может быть уже отмечено между внешними зданиями и линией улицы? Всё, что угодно, что там есть или было, и что осмеры посчитали нужным к данному моменту ввести. В первую очередь это тротуар. Тротуары при их наличии могут быть обозначены отдельными линиями {% tag "footway=sidewalk" %} или тегами {% tag "sidewalk=*" %} на линиях улиц. В этой записи при рассмотрении тротуаров мы будем подразумевать отдельные линии по нескольким причинам. Во-первых, если тротуар не обозначен отдельной линией, у него нет отдельной геометрии в осмовских данных. Нам, интересующимся в настоящий момент преобразованиями геометрии, не понадобится такой тротуар рассматривать. Во-вторых, можно предположить, что при рассматриваемом уровне детализации рисование тротуаров отдельными линиями будет являться целью участников. Если у нас достаточно данных внутри квартала, которые мы не хотим испортить его перемещением, тротуар вокруг него нам уже не будет казаться лишним. Кроме того, внутри квартала, вероятно, будет достаточно проходов, каждый из которых не обязательно важнее тротуара. Для того, кто взялся их рисовать, логичным будет изобразить и тротуар, особенно если эти проходы с ним соединяются.

Мы начали эту запись с того, что представили себе осмера, вводящего подобные объекты между зданиями и улицами, и обнаружившего, что уже имеющиеся данные ему это делать мешают. Правда, также мы представили, что он, возможно, хочет вводить свои объекты относительно имеющихся данных. Чтобы такое произошло, определённые данные уже должны быть добавлены на момент ввода новых объектов. В общем, можно утверждать, что данные вводятся согласно изменяющимся во времени предпочтениям осмеров, которые зависят от уже введённых данных, и для чего мы можем указать некоторые закономерности.

## Эволюция данных

В одной из предыдущих глав мы уже заметили, что [мелкие объекты часто рисуются после и относительно крупных](../3-counter/#unmoved-not-obvious). По-другому это можно было бы сказать так: менее значимые объекты рисуются после и относительно более значимых. Это звучит уже менее определённо: мало ли, что для кого более значимо. Но и первый вариант неоднозначен. Парой абзацев выше мы уже назвали такие объекты, как здания и тротуары. Что больше - здание или тротуар? Если судить по длине, то обычно тротуар, если по площади, то может получиться по-разному. Вряд ли участник, рисующий тротуар, оценивает и с чем-то сравнивает его площадь. Так что мы не сможем в общем случае дать полностью однозначного ответа на вопрос, что было и будет нарисовано раньше, и что было и будет нарисовано относительно чего. С другой стороны и полностью неоднозначным этот ответ не является.

В итоге можно изобразить модель эволюции данных в определённом месте. Она получится в виде [ориентированного графа](https://ru.wikipedia.org/wiki/Ориентированный_граф), разные ветви которого соответствуют объектам с несравнимой значимостью. Несравнимая значимость для объектов типов А и Б - это когда одна группа участников утверждает, что важнее тип А, а другая - что тип Б. При этом обе группы достаточно активны, чтобы оказать заметное влияние на порядок ввода данных в местах своей активности. Ранее, в разделе [*Мои данные важнее*](../3-counter/#mine-is-more-important) мы уже рассматривали подобное утверждение, и тогда мы признали его неверным для правок отдельного участника в существенной степени на основе последовательности ввода данных большинством. По последовательности ввода большинством или существенной группой участников мы и можем судить об общепринятой значимости разных типов объектов.

Внимательные читатели, конечно, заметили в сказанном выше [круговую логику](https://ru.wikipedia.org/wiki/Круговое_рассуждение): вводится раньше то, что важнее, а важнее то, что вводится раньше. Действительно, анализ эволюции данных можно было бы провести аккуратнее, но для данной записи и так сойдёт. Если вас это сильно смущает, то забудьте, что в этом разделе значимость упоминалась вообще. Можно считать, что мы просто видим последовательность ввода данных в интересующих нас условиях и ожидаем её повторения в подобных условиях, причины же всего этого нам неизвестны. Некоторые причины важности помимо последовательности, кстати, тоже указывались в [*Моих данных*](../3-counter/#mine-is-more-important).

Перед тем, как привести диаграмму, сделаем ещё несколько примечаний. Первое, что нужно отметить, это то, что пока она основана на моих впечатлениях без количественных оценок. Более точно её можно было бы получить, взяв репрезентативную выборку городов и проследив изменение данных для них. Позже я, возможно, это проделаю. Далее, раз уж была упомянута выборка городов, надо заметить, что рассматриваем мы только ситуацию в городе с достаточно чётко определёнными улицами и кварталами, а не в другом виде местности, например, в лесу. В лесу, кстати, тоже могут быть [кварталы](https://wiki.openstreetmap.org/wiki/RU:Tag:boundary%3Dforest_compartment), но у нас речь идёт не о них. Наконец, отметим, что указанная модель эволюции годится только для тех мест, объекты в которых существовали до начала осмерской активности. Если квартал мапится во время своего строительства, дела могут обстоять по-другому.

<p class="notice">
В данном месте должна быть диаграмма; она существует на листе бумаги и её надо перерисовать.
</p>

{% TODO %}добавить в диаграмму про дробление landuse{% endTODO %}

## Наличие тротуаров

Поскольку нас интересует в первую очередь, включать ли тротуары в область сдвига, рассмотрим их. Как мы знаем, они могут быть не нарисованы. Такое бывает в следующих случаях:
* тротуара на самом деле нет;
* до рисования тротуара никто ещё не добрался;
* отдельную линию для тротуара посчитали излишней.

Глядя только на данные, не всегда можно понять, какой из вариантов имеет место. При доступных снимках, и, тем более, при разведке на местности, легко определить первый вариант. Для тех мест, которые рассматриваются в данной записи, он нетипичен, так как тротуары обычно есть со всех сторон вокруг кварталов. Далее мы будем считать, что тротуар в реальности существует. Два оставшихся варианта не обязательно противоречат друг другу, так как это могут быть мнения разных участников. Считающие, что линия тротуара не нужна, могут придерживаться своего мнения пассивно, то есть сами они линию рисовать не будут, но нарисованную кем-то другим линию удалять они удалять не будут. В реальности так, по-видимому, и есть, потому что активных удалений линий тротуаров не наблюдается.

Что же позволяет некоторым участникам считать, что линии тротуаров не нужны? Ответить на этот вопрос можно тоже с помощью эволюции данных. Данные в каждом месте имеют тенденцию к усложнению, но нелогично было бы сразу требовать сложных данных. Логично наоборот начинать с того, чтобы обозначать всё самым простым способом. Самый простой способ обозначить улицу целиком - проезжие части, тротуары, всё, что между и рядом с ними - провести одну линию, которой и является {% tag "highway=*" %}. Этот элемент мы и видим наверху нашей схемы эволюции. Если не указано иное, то эта линия является также и обозначением возможности пешеходного движения вдоль неё. Раз эта возможность обозначена, то становится меньше причин обозначать её ещё каким-то способом. Собственно, некоторые участники скажут, что здесь надо и остановиться, так как отдельные линии тротуаров лишние, они лишь загромождают данные, в линиях нет смысла, так как и так ясно, что у каждой улицы тротуары есть по обеим сторонам, тротуары не являются отдельными от улицы объектами и так далее.

Помимо логичной идеи о простоте данных, создание линий тротуаров тормозится идеей автомобилецентризма. Согласно этой идее, линии, вдоль которых разрешено движение, помимо рендеринга, задаются в первую очередь для построения маршрутов. Маршруты же нужны в первую очередь автомобилистам, а пешеходам они не так нужны или совсем не нужны. Автомобилисты едут далеко, оказываются в незнакомых местах и вообще торопятся. Пешеходы же ходят недалеко и по знакомым, часто каждый раз тем же самым местам, и никуда не торопятся, потому что если бы они торопились, то они бы воспользовались автомобилем, а если его нет, то общественным транспортом.

В некотором роде эта идея верна. На пешеходных скоростях действительно больше времени на принятие решения, куда перемещаться дальше. Следовательно, это решение можно принять и без помощи навигатора, пользуясь только изображением карты. Так обычно пешеходы и делают, если тротуары не нарисованы, подразумевая, что у улицы есть тротуары с обеих сторон, и что перекрёсток можно перейти в любом направлении. Это предположение обычно верно, но бывают и исключения, в первую очередь для переходов. У обычного перекрёстка может быть не четыре перехода, а три, у Т-образного - не три, а два, потому что какие-то направления переходов могут быть запрещены. Тогда будет лучше оказаться на правильной стороне улицы перед перекрёстком, иначе может оказаться нужным переходить улицу несколько лишних раз.

Чтобы оказываться на оптимальных сторонах улиц, нужно иметь данные о переходах. Однако, эти данные, если они в принципе есть, могут находиться в не вполне подходящем для пешеходов виде. Согласно идее автомобилецентризма, пешеходные переходы являются в первую очередь препятствием для автомобилистов. Отсюда берётся их более раннее обозначение точкой на линии улицы, без линии, соединяющей тротуары. Если мы этой идее следовать не собираемся, то переходы нам нужны с линиями, а тогда нам нужны и линии тротуаров, которые переходами соединяются. Если также принять, что существуют места без тротуаров, то становится ясно, что толк от линий тротуаров есть, и кто-нибудь до их рисования доберётся.

Если мы утверждаем, что отдельные линии тротуаров являются дальнейшим этапом эволюции данных, у нас есть соблазн посчитать, что там, где распространены мнения о ненужности этих линий, карта ещё не достигла существенного уровня детализации. Существенный уровень - это тот, который нас и интересует, так как именно при нём наши неосторожные действия по перемещению могут многое испортить. Однако можно посмотреть, например, на данные по Германии, и увидеть, что тротуары отдельными линиями там встречаются не слишком часто, а указывать на недоразвитость этих данных не слишком уместно. Известный аргумент против линий тротуаров в данном случае заключается в том, что неважно, где находится тротуар, если улицу можно без проблем перейти в любом месте. Этот же аргумент годится и для мест без интенсивного автомобильного движения. Получается, что противоположная автомобилецентризму крайность может также сыграть против отдельных линий. С точки зрения наших текущих задач о сдвиге мы не против подобных мнений, так как при них у нас будет меньше проблем. Другое дело, что сам сдвиг может быть обусловлен необходимостью добавления тротуаров, если мы с такими мнениями не согласны.

## Форма тротуаров

Участников, добравшихся таки до рисования тротуаров, иногда бывает не остановить. Они могут быть готовы рисовать тротуары и переходы даже там, где их нет. Данные, с которыми нам понадобится работать, могут быть результатом такого торопливого и неаккуратного рисования. Тут можно было бы указать много явлений, связанных с подобного рода редактированием, но, поскольку данная запись не про пешеходную навигацию, ограничимся здесь тем, что нужно для принятия решения о сдвиге.

Когда начинают рисовать тротуары там, где они совсем не нарисованы, часто делают это вдоль отдельной улицы. На протяжении нескольких кварталов, а то и всей длины улицы проводится линия {% tag "highway=footway" %}. Её пока не делят на собственно тротуары и переходы, так что на ней может не стоять тег {% tag "footway=*" %}. Поскольку в нашей ситуации квартал сдвинут, то высока вероятность, что и прочие кварталы, мимо которых идёт линия тротуара, сдвинуты. Сдвинуты они могут быть на различное расстояние, что должно вызвать затруднения у рисующего линию участника.

Сама улица, скорее всего, либо прямая целиком, либо имеет прямые участки длиной в несколько кварталов. Тротуар вдоль улицы обычно настолько же прямой, насколько и сама улица. Соответственно, его хочется провести прямой линией. Также хочется, чтобы эта линия проходила через площадь тротуара. Раз у нас всё сдвинуто, рисующему может быть неизвестно, где эта площадь находится. Она может быть видна на снимке, а может быть и не видна, причём не видна она может быть по всей стороне улицы из-за того, что снимок был сделан под углом. Следовательно, линия тротуара может оказаться нарисованной не на своём месте даже если улица и дома нарисованы на своём.

Сказанного выше уже достаточно для того, чтобы не слишком заботиться о сохранности положения такой линии тротуара. В нашем случае со сдвинутыми кварталами с её точностью дела могут обстоять ещё хуже. Если прямая линия тротуара проходит вдоль по-разному сдвинутых кварталов, она будет находиться на разных расстояниях от зданий. Если рассматривать площадь тротуара относительно зданий, может быть нереально провести эту прямую через площадь вдоль каждого квартала. Это выглядит как хорошая причина передвинуть кварталы ещё перед рисованием тротуара, но мы знаем, что наши предшественники на такое обычно не решаются. При таких обстоятельствах нам тем более не стоит заботиться о том, где именно проходит линия.

Если мы знаем, что после перемещения квартал не перекроет собой линию тротуара, у нас нет причин включать её в множество перемещаемых объектов. Если знаем, что перекроет, то их тоже нет. Точнее, мы не можем так просто передвинуть линию тротуара, потому что она длинная и проходит не только рядом с нашим кварталом. Что нам легче всего сделать - это проигнорировать её до выполнения сдвига, а потом с помощью {% action "Extrude" %}инструмента выдавливания{% endaction %} (<kbd>X</kbd>) сделать так, чтобы она обогнула квартал. Если мы хорошо представляем себе, куда мы сдвинем квартал, и не хотим, чтобы линия это место заслоняла и во время сдвига, можно выполнить выдавливание сразу. Выполняя выдавливание, мы, скорее всего, не портим идеально прямую форму тротуара, потому что он и не должен быть нарисован в виде одной прямой. Это связано со взаимным расположением тротуара и переходов, которое проявится при дальнейшем уточнении данных.

Перед тем, как рисовать тротуары отдельно от переходов, появляются такие же прямые линии тротуаров, пересекающие уже имеющиеся. Когда такие пересечения возникают на обеих сторонах улицы, появляются точки, между которыми линия тротуара должна преобразоваться в линию перехода. Линия тротуара в этих точках разрезается, чтобы поставить на её участок тег {% tag "footway=crossing" %}. Дальше сам переход может быть сдвинут на своё настоящее место, которое обычно находится дальше от перекрёстка, чем то место, по которому шла нераспиленная линия тротуара. Так участки тротуара вдоль отдельного квартала обретают независимость от участков вдоль других кварталов. Для нас это означает, что их уже можно двигать вместе с самим кварталом.

{% TODO %}серия скриншотов - эволюция линии тротуара{% endTODO %}

Стоит ли выбирать для сдвига участки тротуаров, не пересекающие улицы, которые проходят вокруг квартала, зависит от того, с чем эти участки лучше согласуются: с улицами или с кварталом. Изначально согласование было либо с улицами, либо ни с чем, но вместе с рисованием переходов линии тротуаров вокруг квартала могли быть подогнаны к самому кварталу. Если это произошло, их, конечно, стоит выбрать. При подгоне эти линии могли также соединить вместе в одну замкнутую линию вокруг квартала - в следующей главе написано, [как это может нам пригодиться](../6-select/#use-existing-way). Главное в этом случае заметить, что линия состоит не только из отрезка вдоль одной из сторон квартала, и согласиться с тем, что она будет целиком перемещена или целиком оставлена на месте.

Иногда мы модем обнаружить, что линия тротуара не огибает квартал и не идёт прямо вдоль улицы. Вместо этого она может идти как угодно: то по месту тротуара, то по месту перехода, сворачивая в точках пересечения {% tag "highway=footway" %} в произвольном направлении. Это является примером неаккуратного редактирования, когда участник дорисовывает недостающие проходы продолжением первой попавшейся ему линии, не пытаясь эту линию делить на осмысленные части. Проблемой такого редактирования является распространение тегов с ранее нарисованных проходов на новые, для которых эти теги уже неверны. Нас эта проблема в данный момент не волнует, обратить внимание нам надо только на то, что линия может уходить от нашего квартала в неожиданном направлении. В тех местах, где линия тротуара переходит на проезжую часть, её можно {% action "SplitWay" %}разрезать{% endaction %} (P). Можно также соединить её с другой линией тротуара, идущей вдоль нашего квартала, если у неё совместимые теги, хотя совместимость или несовместимость тегов может оказаться ошибочной ввиду их неправильного распространения.

{% TODO %}Если проделать такие разрезания и соединения линий, получится результат, который мы ожидали увидеть в ходе эволюции - а хаотические линии тоже эволюция{% endTODO %}

Конечно, неаккуратное рисование может выражаться ещё и в том, что линия тротуара будет просто кривая. Никакого определённого расстояния от зданий, параллельности улице, симметрии с противоположным тротуаром может не наблюдаться вообще. Ясно, что такую линию сохранять не обязательно ни относительно зданий, ни относительно улицы. В область сдвига её можно включать или не включать, как нам будет удобнее. Если она нам будет мешать, мы её всегда можем подвинуть вручную, не боясь, что мы что-либо испортим, потому что портить здесь нечего.

## Режим параллельности Х { #parallel-mode }

Как увидеть, что портить есть чего, то есть, что положение линии тротуара было выбрано по какому-то принципу? Для этого можно воспользоваться {% action "Parallel" %}режимом проведения параллельных линий{% endaction %} (<kbd>Shift+P</kbd>). При этом нам надо не испортить данные, используя сам этот режим. Для этого здесь и на других этапах нашей операции лучше пользоваться им в подрежиме проведения линии без тегов. Сейчас нам само проведение линии не нужно, но от него трудно отделаться. Нужно нам средство для оценки параллельности уже имеющихся линий и измерения расстояния между ними. Для этого мы и воспользуемся не вполне по назначению указанным режимом.

### Как не подпортить данные

Посмотрим, как мы можем ошибиться и внести нежелательные данные в режиме параллельных линий при рассматриваемом сейчас и прочих его применениях. Все его применения заключаются в том, что на месте уже существующей линии создаётся её копия, которую можно оттащить на определённое расстояние. Если случайно создать ненужную копию линии и сразу это заметить, то можно сделать undo, что решит проблему. Если это заметить не сразу, то может возникнуть желание лишнюю линию просто удалить. Кроме того, как выяснится далее, использовать undo в данном режиме бывает неудобно, так что и от сразу замеченной линии можно захотеть избавиться удалением.

Если выделить линию и удалить её, то она, конечно, исчезнет, но её точки могут и остаться. Останутся те точки, на которых есть теги, а такие точки у нас наверняка будут, потому что на копию линии и всех её точек переносятся и все теги их прообразов. Сейчас нам понадобится применять режим параллельных линий к линии улицы, а на ней могут быть точки переходов и светофоров с соответствующими тегами. К счастью, [JOSM](https://wiki.openstreetmap.org/wiki/RU:JOSM) перед выгрузкой данных даёт предупреждения про подобные оставшиеся без своей линии точки, но лучше бы им не возникать вообще. Позже нам этот режим может понадобиться уже непосредственно для рисования линий, но копирование светофоров и прочего нам по прежнему будет не нужно.

Чтобы нам не мешали лишние точки с тегами, нам нужен бестеговый подрежим, при котором теги не будут копироваться ни на линию, ни на её точки. Удаление случайно появившейся или, как нам понадобится в будущем, специально проведённой линии в этом случае приведёт и к удалению всех её точек. Чтобы воспользоваться этим подрежимом, надо нажать и удерживать <kbd>Alt</kbd> *до* нажатия и удерживания кнопки мыши. После нажатия кнопки мыши <kbd>Alt</kbd> можно отпустить. Обратите внимание на "до" - этим переход в данный подрежим отличается от различных манипуляций с элементами в режиме выбора, между которыми можно переключаться во время удерживания кнопки мыши. Вам может казаться, что <kbd>Alt</kbd> можно нажать в любой момент до завершения действия, которое произойдёт при отпускании кнопки мыши, но это не так. Нажимать <kbd>Alt</kbd>, находясь уже в процессе перетаскивания поздно, потому что копия линии уже была создана вместе с тегами. В общем, можно было бы посоветовать нажимать <kbd>Alt</kbd> перед каждым действием рисования параллельных линий, если бы не одна неприятная особенность нажатия на <kbd>Alt</kbd>, [которую мы скоро увидим](#parallel-exit).

### Использование в качестве линейки

Вернёмся к нашей текущей задаче определения кривизны тротуаров. Как уже было сказано, линии мы проводить не собираемся. Режимом параллельных линий мы будем пользоваться как линейкой, которую мы будем только двигать и смотреть, что с ней совпадает на каком расстоянии. Двигать мы её будем от предположительно прямой линии улицы до линии тротуара. Конечно, линия улицы тоже может быть кривой или как либо ещё не совпадающей с реальностью, но это менее вероятно, так как она появляется раньше и её правильности уделяется больше внимания. Увидеть, что и она проведена неправильно, мы сможем, если её невозможно совместить со снимком или с треками. Если дела обстоят так, то и тротуары вряд ли проведены правильно, а значит о сохранности их линий заботиться не нужно. С другой стороны, то же может быть верно и для стен зданий, выходящих на улицу, и тогда просто сдвинуть их на правильное место не удастся. У нас найдётся и [более продвинутый способ перемещения зданий](../10-transform/), чем простое перетаскивание, хотя для его применения нам всё равно понадобятся линии, идущие по направлению улиц. Позже мы доберёмся до его описания.

Предположим, что нам повезло, и что улица проведена правильно. Тогда нам надо перейти в режим параллельных линий, и при нажатом <kbd>Alt</kbd> начать тащить линию улицы к линии тротуара и пока не отпускать её. Как только начнётся перетаскивание, появится новая линия, изображение которой мы хотим сравнить с интересующим нас участком линии тротуара. Если перетаскиваемую линию можно совместить с тротуаром так, чтобы они совпадали, то тротуар здесь параллелен улице, и эту параллельность нам следует сохранить. Сохранится она, если участок тротуара не трогать или сдвигать его целиком, что можно сделать, включив в область сдвига все его точки.

Стоит ли двигать участок тротуара, нам могут подсказать соображения симметрии с тротуаром на противоположной стороне улицы. Для этого нам понадобится определить расстояния между осью и тротуарами, которые мы узнаем через расстояния между осью как исходной линией перетаскивания и положениями перетаскиваемой линии у соответствующих тротуаров. Во время перетаскивания расстояние, на которое новая параллельная линия отстоит от своего оригинала, отображается {% help "StatusBar" %}под окном редактирования{% endhelp %} рядом со значком линейки. Кстати, глядя туда, мы можем заметить, что перетаскивание выполняется не свободно, а по полуметровым шагам. Если это мешает нам совместить перетаскиваемую линию с тротуаром, мы можем нажать на <kbd>Ctrl</kbd> либо до, либо во время перетаскивания, чтобы не быть ограниченными шагами.

{% TODO %}скриншот: насколько сдвинута параллельная линия{% endTODO %}

Воспользуемся отображаемым расстоянием как средством измерения. Совместим перетаскиваемую линию с одним из тротуаров, запомним расстояние, совместим с противоположным тротуаром, сравним расстояние с ранее запомненным. Если совмещения удались и расстояния в достаточной степени совпадают, тротуары проведены осмысленным образом. Чтобы не испортить их расположение, лучше их не трогать. Если же не трогать их не получается, потому что они станут перекрыты зданиями, нам предстоит трудоёмкий вариант действий, которым в идеале является перерисовка всех линий, параллельных оси улицы - то, что в данной записи мы не рассматриваем.

Если расстояния между осью улицы и тротуарами оказались разные, это ещё не значит, что осмысленности при их проведении не было. Не следует ожидать одинаковых расстояний, если в реальности тротуары разной ширины, что бывает не так и редко. Реже встречаются ситуации, когда проезжая часть или тротуар вдоль квартала меняют свою ширину постепенно. Тогда не следует ожидать и параллельности линий. Получается, что наша проверка не показывает нам однозначно, когда с линиями можно делать всё, что угодно. Зато она показывает, когда с линиями точно надо обращаться осторожно.

{% TODO %}фотка: тротуары разной ширины{% endTODO %}

### Выход из режима { #parallel-exit }

Сделав то, что мы хотели, с помощью режима параллельных линий, нам надо из него выйти, причём так, чтобы не добавить линию. Добавлять линию мы уже начали, и теперь перед нами стоит вопрос, как эту операцию прервать. Если просто отпустить кнопку мыши, линия будет добавлена. Если нажать на <kbd>Esc</kbd>, она тоже будет добавлена. Если, как это можно сделать для {% action "Select#Selectmultipleobjectsusingselectionrectangle" %}отмены некоторых операций перетаскивания{% endaction %}, нажать правую кнопку мыши перед отпусканием левой, ничего не отменится, и линия всё равно будет нарисована. Нарисована она будет и если переключить режим. На самом деле прервать рисование невозможно, потому что оно уже было совершено, и перетаскивается уже нарисованная линия. Всё, что мы можем сделать это либо удаление, либо {% action "Undo" %}undo{% endaction %}, причём и то и то можно делать прямо в процессе перетаскивания, так как перетаскиваемая линия выделена.

Если вы предпочтёте делать удаление, то вам стоило бы находиться в бестеговом подрежиме по уже рассмотренным причинам. Если вы были не в нём, то удаление - не лучший выбор. Кроме того, удаление в любом случае попадёт в {% dialog "CommandStack" %}буфер отмены{% enddialog %}, чего вы можете не хотеть. Тогда стоит выбрать undo. В этом случае надо обратить внимание на то, что если вы собирались делать undo кликом по кнопке на {% help "MainToolbar" %}тулбаре{% endhelp %}, что вы можете хотеть делать ради всплывающего сообщения об последней операции, и до того вы перешли в бестеговый подрежим с помощью <kbd>Alt</kbd>, то отмена может сразу не сработать. Здесь проявляется та неприятная особенность нажатия на <kbd>Alt</kbd>, обещанная выше: по крайней мере под Windows <kbd>Alt</kbd> передаёт фокус {% help "Menu" %}главному меню{% endhelp %}, и следующий клик потратится на потерю фокуса.[^5-alt-focus] Следовательно, undo лучше делать с клавиатуры (<kbd>Ctrl+Z</kbd>).

[^5-alt-focus]: Особенность наблюдалась под Windows 7. Под Ubuntu 24.04 её, вроде бы, нет.

### Когда нужных линий несколько

Рассмотренное выше применение режима параллельных линий предполагало, что в данных есть линия, проходящая по оси улицы. На самом деле её может и не быть. Самый простой вариант её отсутствия - присутствие на оси вместо одной линии нескольких. В этом случае осмеры решили, что им нужно распилить проезжую часть поперёк на несколько кусков, чтобы рассматривать их отдельно. Причиной этого, обычно, является наличие у кусков разных свойств, которые хочется записать разными значениями тегов. В соответствии с этим и осмовский элемент - линия улицы делится на несколько линий. Если мы потянем за линию в режиме параллельности, то захватится именно один из результатов такого разделения. Для нас он может быть коротковат. Вместо этого нам хотелось бы одновременно тянуть все части, на которые была распилена линия улицы, и которые идут вдоль квартала.

Решение этой проблемы простое. Перед протягиванием параллельной линии нам необходимо выделить все куски улицы, относительно которых мы будем откладывать новую. Это сработает, если выделяемые элементы-линии соприкасаются своими концами, и образуют непрерывную цепочку, что как раз и будет в нашем случае. Выделять линии можно не только в режиме выделения, но и прямо в режиме параллельных линий. Эта возможность присутствует благодаря тому, что данный режим по совместительству является урезанным режимом выделения. В нём доступно выделение только линий только непосредственным кликанием по ним, с модификаторами-клавишами <kbd>Shift</kbd> для добавления к выделению и <kbd>Ctrl</kbd> для добавления/исключения. Подробнее эти, а также другие операции выделения будут рассмотрены в [следующей главе](../6-select/).

При другом распространённом варианте отсутствия линии на оси улицы там не будет и отдельных её кусков. Речь идёт о [двухвейке](https://community.openstreetmap.org/t/topic/51518),[^5-dual] когда проезжую часть осмеры делят не поперёк, а вдоль. Это выражается в том, что вместо одной линии прямо на оси рисуются две линии с двух сторон от оси. Мы можем ожидать, что эти линии параллельны друг другу и оси, потому что для этого есть причины и в реальности, и в средствах редактирования, таких, как рассмотренный режим параллельных линий. Логично предположить, что сначала была нарисована осевая линия, а потом от неё на одинаковых расстояниях были отложены две параллельные линии для двух сторон улицы. Осевая линия могла быть как временной, вспомогательной, существующей только в процессе редактирования, так и реально присутствовавшей в данных *одновейной* {% tag "highway=*" %}. Согласно нашей модели эволюции данных было, скорее всего, второе. Первое же - это то, что нам, возможно предстоит сделать самостоятельно, если наши ожидания на счёт параллельности не оправдались, и это снова тот самый трудоёмкий способ перерисовки осей.

[^5-dual]: См. также [Dual carriageway](https://wiki.openstreetmap.org/wiki/Dual_carriageway) и [RU:Key:oneway](https://wiki.openstreetmap.org/wiki/RU:Key:oneway) по поводу того, стоит это делать или нет.

Почему наши ожидания могут не оправдаться? Вроде бы, нет никакого смысла делать линии специально кривыми, тем более, когда в данных уже есть то, относительно чего можно их без труда сделать прямыми. Однако так на редактирование данных смотрят далеко не все. Идея рисования двухвейки, также как и идея рисования тротуаров, могла прийти местному сообществу осмеров или даже отдельному осмеру внезапно. К этому моменту уже имелось существенное количество данных, введённых *по-старому*, вызывающих своим видом желание их переделать. При доступных панорамах улиц переделывать данные можно в массовом порядке, без отрыва от [условного дивана](https://wiki.openstreetmap.org/wiki/RU:Диванное_картографирование).

Выполняющий переделывание участник может заботиться в первую очередь о количестве и нужной для его достижения быстроте, а не о качестве. В итоге получается то самое торопливое рисование, которое мы уже рассмотрели в связи с тротуарами. Кривые линии улиц мы уже тоже упоминали, но тут у торопящегося осмера появляется ещё одна возможность их создать: заменить один прямой highway на два кривых. Если при одной кривой линии улицы мы вряд ли могли рассчитывать на прямизну всего остального, то при двух вероятность прямизны выше, так как выравнивание могло быть выполнено по теперь несуществующей прямой. То есть, вполне возможно обнаружить прямые тротуары при кривых линиях улицы.

Проверить параллельность обеих линий двухвейки можно очевидным для всех, кроме рисующих кривые двухвейки, способом: режимом параллельных линий. Если с линиями всё в порядке, можно в том же режиме измерить расстояния между тротуарами и ближайшими к ним линиями улицы, затем эти расстояния сравнить. Если с линиями не всё в порядке, можно проверить параллельность тротуаров, игнорируя линии улицы. Если в последнем случае параллельность наблюдается, значит высока вероятность того, что рисовавший двухвейку данные подпортил. Мы в этой записи рассматриваем, как данные не портить, соответственно, те параллельности и симметрии, которые были определены любым из перечисленных выше способов, мы постараемся сохранить.

## Площади и их границы

Наконец, эволюция могла зайти и ещё дальше, так что в данных присутствуют площадные highway или барьеры между проезжей частью и тротуаром. Для их представления нужны линии на границе между тротуаром и проезжей частью, и нам надо решить, как с этими линиями поступить. Может показаться, что если дело рисования зашло так далеко, то квартал наверняка стоит на своём месте. Как выясняется, это вовсе не обязательно верно, особенно если не было попыток нарисовать площадной тротуар. Чтобы нарисовать поребрик вдоль квартала, надо возиться с десятками элементов, а чтобы передвинуть квартал - с сотнями. Порог лени мог не дать сделать последнего, но дать сделать первое.

Поступить нам предстоит, скорее всего, в зависимости от того, какие из рассматриваемых объектов нарисованы. Если нарисована только площадная проезжая часть, то её трогать обычно не нужно. Убедиться в этом можно, отмерив расстояния до обеих её сторон от оси. Если получится, что здания после сдвига с ней перекрываются или неестественно близко к ней подходят, то это опять *трудоёмкий способ*. При перерисовке осей мы получим все необходимые линии и для площадных проезжих частей и для площадных тротуаров, хотя само рисование этих объектов мы можем до конца и не доводить. В данном случае с проезжую часть нам доделать придётся, а тротуар мы можем пропустить.

Если нарисована только граница между проезжей частью и тротуаром, то дальнейшие вероятные действия зависят от её фрагментарности. Фрагментарность обычно обусловлена заборчиками - ["пешеходными ограждениями"](https://commons.wikimedia.org/wiki/File:Fence_PO-1_Krest._Saint_Peterburg.jpg), которые бывают рядом с перекрёстками. Они часто небольшой длины, так что рисовавший их участник мог не посчитать нужным их выравнивать. Единственное, о чём он мог позаботиться, это о том, чтобы линия тротуара была с правильной стороны от заборчика. Тут заложена потенциальная неточность. Заборчики часто бывают на углах у перекрёстков, где линии тротуаров проведены наименее точно. В таких местах линии тротуаров обычно надо скруглить, а линии переходов - отодвинуть от перекрёстка. После этого заборчик можно нарисовать на своём месте относительно перекрёстка, и при этом он будет правильно расположен и относительно тротуаров с переходами.

Однако часто до скруглений и отодвиганий дело не доходит, и тогда пешеходные линии находятся существенно ближе к линиям улиц, чем нужно. Если при этом относительно линий рисовался и заборчик, то и он находится ближе к улице, чем нужно. Так как при этом единственно правильной информацией в осмовских данных является взаимное расположение заборчика и тротуара, поступить с заборчиком нам следует так же, как мы поступим с тротуаром: либо их обоих двигать, либо обоих оставить на месте. Если скругление у тротуара на углу есть, то велика вероятность, что заборчик нарисован относительно тротуара, значит поступить нам надо аналогичным образом: двигать или не двигать и то, и то.

{% TODO %}фотка: заборчик на скруглённом углу{% endTODO %}

Другой вариант расположения заборчика - параллельно улице. Соответственно, возрастает вероятность, что именно относительно улицы он и был нарисован, в случае чего его трогать не следует. Вероятность эта тем выше, чем длиннее заборчик. Ещё более длинным объектом является поребрик. Его рисование имеет смысл выполнять как минимум на протяжении всего квартала, а, значит, оно весьма похоже на рисование площадного тротуара или проезжей части. Если поребрики нарисованы по обеим сторонам от улицы, то поступить нам следует, как при нарисованной площадной проезжей части. Если поребрик нарисован лишь с одной стороны улицы, мы находимся ближе к варианту с площадным тротуаром, к которому мы сейчас перейдём.

Что делать, если нарисован только площадной тротуар? Может показаться, что его надо двигать вместе с кварталом, ведь он даже соприкасается со зданиями. Внутренние точки соприкосновения со зданиями двигать, конечно, придётся вместе со зданиями, но это не обязательно означает, что надо двигать и внешние точки у проезжей части. Кстати, иногда и внутренние точки не соединяют со зданиями - это верный показатель того, что тротуар рисовался относительно улицы, и его двигать целиком не надо. Внутренние точки в таком случае лучше поправить после сдвига квартала. Тем не менее, даже если внутренние точки соединены со зданиями, это не значит, что и внешние точки были нарисованы относительно зданий. Вероятная причина этого такая: границу тротуара и проезжей части на снимках видно гораздо лучше, чем края зданий. В результате эту видную границу могли провести по тому же снимку, по которому провели и линию улицы. Здания же по этому снимку было нарисовать на своём месте сложнее из-за того, что объекты, находящиеся в реальности на разной высоте могут выглядеть смещёнными на снимке. Внешний край тротуара находится на уровне земли, а видимые края зданий - на высоте самих зданий, отсюда может происходить их несогласованность.

Для прояснения ситуации нам по-прежнему доступен режим параллельности. Мы можем сравнить расстояние от оси до зданий, то есть до внутренних границ тротуаров, с обеих сторон улицы. Если оно одинаковое, нам надо ещё раз подумать, действительно ли мы хотим двигать квартал. Двигать его придётся, если мы подозреваем, что расположение улицы было подогнано под здания без учёта правильности расположения последних. Если площадные тротуары нарисованы с обеих сторон улицы, мы можем сравнить их ширину. Её одинаковость будет говорить в пользу перемещения внешней границы вместе со зданиями.

Наконец, мы можем посмотреть на расположение линии тротуара внутри площади тротуара. Если линия идёт строго по середине, то это тоже добавляет причин двигать внешнюю границу так же, как и все прочие элементы тротуара. Для наших предшественников линию тротуара логично было попытаться провести посередине его реальной площади, так что когда мы её обнаруживаем и посередине площади в данных, это говорит об обозначении различных элементов согласно одному снимку. Впрочем, надо иметь в виду, что посередине линия тротуара идти не обязана, и могли существовать причины, по которым она была проведена ближе к проезжей части. Конечно, такие рассуждения нам не нужны, если вся площадь тротуара на снимке хорошо видна, но её часть может быть закрыта изображением здания.

Нерассмотренными остались случаи, когда нарисованы одновременно несколько из разбираемых нами сейчас видов объектов. Так, может быть нарисована площадь тротуара вместе с барьером на его границе или площадь тротуара вместе с площадью проезжей части. Скорее всего, нарисованы эти объекты были относительно улицы. Можно надеяться, что читатели понимают, как убедиться в верности или неверности этого в конкретной ситуации. Описываемые здесь для этого средства достаточно очевидны, хотя большинство участников ими не пользуется. С другой стороны, большинству и не надо выполнять рассматриваемые в этой записи операции.

В целом по поводу площадных хайвеев можно сказать, что главное - заметить их, когда они присутствуют в данных, после чего становится возможным предпринять действия по их сохранению или улучшению. Они являются объектами с не самой широкой поддержкой, так что некоторые участники, увидев площади в редакторе, могут вообще не понять, какую роль они играют. К таким участникам наверняка можно отнести многих, чьи действия описываются в первой части записи.

## Прочее на тротуарах

Помимо площадных хайвеев и связанных с ними барьеров встречаются и прочие вытянутые вдоль улицы объекты. В первую очередь к ним относятся газоны у тротуаров, которые часто рисуют ещё до {% tag "area:highway" %}. Они обычно имеют прямоугольную форму и обозначаются, за неимением ничего лучшего, как {% tag "landuse=grass" %}. Прямоугольник газона прерывается в местах расположения проездов к зданиям. На квартал таких разрывов может быть 5-10 штук, и газон превращается в соответствующее количество отдельных прямоугольников. Рисовать газон тоже можно было бы разрезанием большого прямоугольника на маленькие, но осмерам это делать бывает лень. В итоге вместо образованных из одного и соответствующим образом выровненных прямоугольников часто можно встретить прямоугольники независимые и весьма коряво нарисованные. Чем кривее газоны нарисованы, тем легче для нас: от нас понадобится меньше усилий, чтобы их не испортить. Наиболее вероятным способом действий для нас будет двигать их вместе со зданиями, особенно, если между кусками газонов нарисованы проезды. Как проверить, насколько криво газоны нарисованы, читатели должны были уже догадаться.

Из прочих вытянутых объектов можно отметить расположенные вдоль улиц парковки в форме прямоугольников или трапеций. Поступать с ними можно как с площадью дороги или тротуара, в зависимости от того, где они находятся. Ещё встречаются ряды деревьев ({% tag "natural=tree_row" %}), которые часто, хотя и не всегда, бывают на газонах. Ситуация с ними похожа на ситуацию с газонами, только вместо прямоугольников у нас прямые. Отсюда ясно, что с ними делать, даже если они не нарисованы на газонах. Со всем же, что на газонах, следует поступить таким же образом, как и с самими газонами.

Ряд деревьев, вместо линии, может быть обозначен точками для каждого отдельного дерева. В более общем случае может иметься последовательность точечных или даже площадных объектов, выстроенных вдоль одной линии. Такой последовательностью может быть ряд фонарных столбов или клумб. Тогда нам может понадобиться точно так же, уже известными нам средствами проверить, прямая ли это линия, относительно чего она проведена, и заключить из этого, что с ней делать. Перечисленные до этого места и прочие ориентированные по оси улицы объекты - это то, что нам придётся затронуть, если дело дойдёт до способа *перерисовки осей*.

На тротуарах у квартала встречаются и объекты попроще, обозначаемые обычно точками. Это всякие урны, скамейки, велопарковки. Обычно их следует передвигать вместе со всем кварталом. Объясняется это тем, что часто их не видно на спутниковых снимках, следовательно, отмечены они, скорее всего, относительно нарисованных ранее зданий. Здания мы как раз сдвинуть хотим, значит стоит сдвинуть и эти точечные объекты. Несколько более заметны на снимках бывают ларьки, и у них есть вероятность быть нарисованными полигонами. Чаще всего с ними имеет смысл поступать аналогично, хотя нас также может интересовать их положение относительно линии и площади тротуара.

Отдельно стоит упомянуть такой обычно точечный объект как остановка наземного общественного транспорта. Остановки, в отличие от урн, могут быть хорошо видны на снимках, если у них есть павильон. Павильон обычно виднее ларька, так как он находится дальше от зданий и ближе к дороге. Значит, проблем с решением, куда ставить точку остановки, обычно нет. Однако, просто точкой остановка обозначена не всегда. Сам объект остановки мог быть разложен на два. Первое - место, где пассажиры ждут транспорт и с которого совершают посадку/высадку. В осме оно называется *платформой*, хотя в реальности платформы в привычном смысле этого слова может и не существовать, и в нашем случае её и нет. Именно этой осмовской *платформой* и является точка на тротуаре, обычно находящаяся на месте павильона. Вместо точки может быть использована и линия, как замкнутая, так и незамкнутая. Непосредственно павильон такая линия обозначать не обязана. Также может быть обозначено и второе место - то, где непосредственно останавливается транспортное средство. Оно практически всегда обозначается точкой, находящейся на линии, включённой в маршрут транспорта. Этой линией является либо улица, либо трамвайный путь.

Традиционно остановки обозначались одной точкой, причём автобусные-троллейбусные - точкой платформы, а трамвайные - точкой остановки самого трамвая. Такое различие было неудобно, и устранить его была призвана [вторая версия транспортной схемы](https://wiki.openstreetmap.org/wiki/PTv2), предполагающая обозначение обоих мест. В результате появилось другое неудобство - необходимость использовать два элемента вместо одного для обозначения остановки на месте и для записи её в отношение маршрута. Новое неудобство кажется некоторым участникам бо́льшим, чем старое, так что новой версией транспортной схемы пользуются не все.

В этой записи мы не собираемся сравнивать преимущества и недостатки схем, потому что она не про обозначение остановок. Мы всего лишь хотим не испортить обозначенную остановку, каким бы способом это ни было сделано. Для этого нам надо обратить внимание, что если на тротуаре есть точка или линия платформы, то на линии улицы может как быть, так и не быть точки остановки. Если её нет, то дело обстоит просто: нам надо подвинуть платформу либо на то место, на котором она видна на снимке, либо, если такого места не видно, включить её в область сдвига вместе со всем кварталом. Если же точка остановки на линии улицы присутствует, то с ней надо поступить таким образом, который соответствует нашим действиям с платформой. При этом придётся проявить дополнительную предосторожность, чтобы не испортить эту линию.

Предположим, что точка остановки существует. Первое, что можно проверить, это поставлена ли она каким-либо осмысленным образом относительно платформы. Если нет, то мы её трогать не будем, и её исправление, если оно необходимо, оставим на потом. Осмысленным положением может быть место на линии, ближайшее к точке платформы, если платформа является точкой. Если платформа точкой не является, рисовавший её участник мог хотеть показать, что здесь останавливается что-то длинное, например, трамвай с несколькими вагонами. Тогда и точка остановки может быть поставлена с учётом размеров транспортного средства, а именно там, где у него "нос". В любом случае, осмысленно расположенная точка остановки будет находиться в пределах того отрезка пути, который находится напротив платформы. Если же точка остановки находится где-то в стороне от платформы, то это и будет неосмысленным расположением. Оно может появиться в результате того, что точка была поставлена относительно чего-то другого, но более вероятным вариантом является то, что про неё забыли, когда двигали платформу, и таким образом её испортили. Мы же постараемся так не ошибиться.

Теперь предположим, точка расположена осмысленно относительно платформы, и это расположение мы хотим сохранить. Тогда логично её двигать вместе с платформой: либо вручную, когда точка выделена вместе с платформой, либо включив точку вместе с платформой в область сдвига, в зависимости от того, что мы решили делать с платформой. Проблемой при таком способе действий станет то, что мы изогнём линию пути, в который входит точка. Здесь мы можем сделать выбор: либо стараться не гнуть его вообще, либо гнуть, но потом, после сдвига квартала исправить. Наш выбор будет зависеть от того, что мы соберёмся делать с ещё одной разновидностью объектов: проездами от улицы к внутренностям квартала.

## Пересечения границ области сдвига

В этой главе мы решаем, какие объекты включать в область сдвига, а какие - нет. При этом мы точно знаем, что здания квартала нам включить в область надо, а линию улицы - нет. Отсюда следует, что если у нас есть объекты, соединяющие здания и улицу, то для них этот выбор при данных условиях осуществить не удастся, если брать их целиком. Самым распространённым видом таких объектов являются внутриквартальные проезды, соединённые с улицей, на которых мы остановились в конце предыдущего раздела.

Как и в предыдущем разделе, перед нами стоит выбор. Один из вариантов - сдвигать вместе с кварталом не все точки проездов, то есть оставлять на месте точку соединения с улицей и, возможно, с тротуаром, если тротуар мы тоже не двигаем. В результате этого проезды деформируются, и их позже придётся исправлять. Другой вариант - отказаться от того, что улицу мы не трогаем, и двигать проезд целиком. Теперь исправлять придётся уже деформирующуюся улицу. Строго говоря, точки улицы нам придётся двигать в обоих вариантах, так как без этого не исправить форму проездов. Отсюда можно заключить, что предпочтительней второй вариант. К сожалению, у него есть свои недостатки, такие как более сложная операция выбора объектов для сдвига и необходимость в большей степени следить за тем, чтобы сдвигаемые точки не перепутались с несдвигаемыми. В итоге выбор часто делается в пользу первого варианта, и лично я чаще делал выбор именно таким образом.

Выбор в пользу деформации проездов можно объяснить большей важностью улиц. Осуществляя сдвиг, мы в первую очередь не хотим испортить именно улицы. Форма проездов нас беспокоит в меньшей степени, особенно учитывая то, что она более произвольна.[^5-bound] Если мы забудем сделать поправку искажённой формы объектов после сдвига квартала, то лучше пусть это будет форма проездов, а не улиц. Кстати, точки пересечения проездов с улицей, как и упомянутые в предыдущем разделе точки остановок на улице, можно двигать даже вручную без искажения содержащей их линии улицы. В ряде случаев такой поправки будет достаточно, особенно, если никакой точности в положении этих точек до наших действий не было. [Как именно это делать](../11-cleanup/#corners), догадаться не так-то просто, и до этого мы доберёмся в [главе про поправки после сдвига](../11-cleanup/) (спойлер: <kbd>X</kbd> и перетаскивание с <kbd>Ctrl</kbd>).

[^5-bound]: Часть проезда, выходящая на улицу, обычно не имеет чётко выраженных границ, о чём мы ещё поговорим в этой записи. Часть проезда во дворе внутри квартала также может не иметь чётких границ, о чём мы в этой записи говорить не будем.

Помимо двух вариантов - деформировать проезды и деформировать улицы - у нас имеется ещё один - не деформировать ни того, ни другого. Для этого нам понадобится перед сдвигом квартала и даже перед его выделением рассоединить линии проездов и улиц, а после сдвига - соединить их обратно. В итоге, несмотря на отсутствие деформаций, этот вариант тоже обладает существенными недостатками, связанными с операциями разъединения-соединения. Забыть же соединить разъединённые линии мы точно не хотим. В связи с тем, что при этом варианте действий нам надо редактировать данные ещё до сдвига квартала, чего мы при прочих вариантах не делаем, мы также отложим [рассмотрение необходимых для этого операций](../11-cleanup/#move-driveways-with-block) до главы про поправки после сдвига. Именно в той главе и рассматривается большая часть операций редактирования за исключением самого сдвига квартала.

Какой вариант предпочтительнее для конкретной ситуации, станет понятно при рассмотрении соответствующих ему действий для выделения объектов и, особенно, для поправок после сдвига, рассматриваемых в следующих главах. Несмотря на объём данной главы само решение о том, что включать в область сдвига мы примем за пару секунд. Чтобы осуществить это решение, понадобится уже несколько десятков секунд. На поправки после сдвига может уйти несколько минут, и тут уже разница во времени между вариантами станет ощутимой.

## Границы квартала

В целом, определение области для сдвига заключается в поиске того, что было нарисовано относительно квартала. Также приходится принимать решение о том, что нарисовано относительно квартала лишь отчасти, типа проездов. Всё это можно сделать, когда у нас имеется квартал с определёнными границами, с которым реально иметь дело целиком. Это лишь одно их предположений, которое мы использовали в рассуждениях.

Ещё одним нашим предположением являлось то, что улицы вдоль квартала прямые. Выражалось оно в утверждениях про параллельность линий относительно оси улицы. На самом деле это предположение для нас не так важно. Вместо параллельности можно рассматривать постоянство расстояния между линиями за исключением их углов. Это параллельность в том смысле, в каком её производит режим параллельных линий: работать в нём можно не только с прямыми линиями, но и ломаными. Впрочем, дополнительные трудности из-за непрямоты улиц у нас появиться могут. Квартал с границей сложной формы сложнее выделить. Также для изогнутой улицы сложнее перемещать точки её пересечения с проездами.

Очень кривая улица, если она дополнительно к этому и узкая, может стать причиной того, что работать отдельно с таким кварталом будет неудобно. Также, достаточно часто идущих улиц, разрезающих застроенные площади, может и не быть. Вместо этого может иметься достаточно большой кусок территории, вглубь которого уходят тупиковые, возможно разветвляющиеся проезды. В подобных случаях мы можем работать вместо одного квартала с любой областью, у которой границы более удобны. В качестве границ мы можем взять любые достаточно широкие промежутки между отмеченными в осме объектами. Главное, чтобы всё внутри области было нарисовано с более-менее одинаковым смещением, иначе не будет смысла всё это совместно перемещать. Если это не так, то возможно, что ничего лучше, чем двигать вручную отдельные объекты, сделать нельзя, и тогда данная запись в качестве руководства к действию не подходит. Дальше мы будем считать, что с ситуациями, описанными в данном абзаце, нам сталкиваться не придётся.
