---
title: Введение
---

В этой записи пойдёт речь о том, что делать, если в городских условиях смещение зданий не совпадает с тем, которое мы считаем правильным. Ясно, что надо что-то подвинуть, и в этой записи будет рассказываться о том, что начинать лучше со сдвига всего квартала, а не отдельных зданий или их частей. При этом мы не будем рассматривать, что делать при несовпадении смещения улиц между кварталами. Эту задачу желательно решить перед тем, как браться за кварталы, и на протяжении записи мы будем ссылаться на один из способов её решения, который в полной мере здесь описан не будет.

Основной смысл записи такой: если вы редактируете осмовские данные в городе и обнаруживаете, что некоторые относящиеся к какому-либо кварталу объекты смещены относительно желаемого положения, посмотрите на контур квартала. Если смещён и он, попытайтесь сначала сдвинуть весь квартал. Почему именно квартал? Как лучше сдвинуть весь квартал? На эти вопросы и отвечает данная запись. Посмотрев на её размер, вы можете подумать: "Разве кто-то будет действовать описанным способом? Тут многовато написано." Однако, всю запись читать не обязательно, а её размер объясняется тем, что приводятся мотивировочные рассуждения и разные варианты действий.

Вкратце предлагаемые действия можно описать так: берём josm, ставим плагин utilsplugin2, рисуем вокруг квартала замкнутую линию, применяем команду выделения всего внутри линии, перетаскиваем выделенное. Если результат перетаскивания неудовлетворительный, ставим плагин commandline, рисуем рамку вокруг целевого места, перемещаем туда квартал скриптом для плагина. Дальше делаем различные мелкие поправки, количество которых зависит от наших целей. Собственно наши возможные цели, причины поступать именно так и последствия от действий по-другому рассматриваются в начале записи.

Большая часть записи состоит из описания операций по редактированию данных, выполняемых из josm. Я надеюсь, что даже если вы не согласны с приведёнными методами действий или они неприменимы к тем данным, с которыми вам обычно приходится иметь дело, вы всё равно сможете узнать из этой записи о какой-нибудь особенности josm, которая пригодится вам для других целей. Можно даже практически гарантировать это, потому что сами разработчики josm тоже не знают всех особенностей своего редактора.[^1-undoc] Также, хотя это и не является основной целью записи, в ней можно найти ответы на вопросы *почему я маплю так, а не иначе*, в частности:
- почему я именно так рисую landuse;
- почему я не ставлю {% tag "railway=tram_crossing" %} на пересечения трамвайных путей с другими хайвеями;
- почему я обычно не соединяю в одной точке проезды с разных сторон улицы.

[^1-undoc]: Мы увидим это на примерах недокументированных деталей и странных сочетаний операций josm, в частности Ctrl-drop; а также по тому, как логика работы команд менялась после обнаруженных там багов. Это не следует понимать как утверждение о том, что josm плохой, подобные особенности есть и у других редакторов, например у maps.me. По количеству же багов плагин редактирования к osmand превосходит всё, чем я успел попользоваться к данному моменту.

Прежде чем переходить к самой записи, имеет смысл договориться об используемых терминах и обозначениях. Словом *редактор* мы будем называть ПО для редактирования данных, а не человека, занимающегося редактированием. Словом *пользователь* мы будем называть человека, использующего указанное ПО, а не учётную запись или её обладателя. Словом *участник* мы будем называть человека, участвующего в редактировании данных, который может являться, а может и не являться пользователем рассматриваемых средств ПО. Участник для разнообразия может называться и другими словами, например, *осмер*.

Всю запись нам придётся говорить о том, что мы представляем посредством чего. *Объектами* мы будем называть то, что существует в реальности и что мы хотим представить в данных. Чаще, конечно, мы будем называть объекты менее абстрактно, то есть пользоваться словами *улица*, *здание* и подобными. При редактировании данных мы представляем объекты в виде *элементов*, к которым относятся *точки*, *линии* и *отношения* - это уже не реальные объекты, но работаем мы именно с ними, и именно их можно скачать и закачать. В данной записи отношения нам практически не понадобятся, да и линии обычно будут играть вспомогательную роль, потому что в основном мы будем перемещать точки. На самом деле, мы не будем всегда строго различать объекты и элементы. Когда это будет проще и не сможет вызвать неопределённости, элементы мы станем называть по представляемым ими объектам. Если вы заметили, выше мы уже это однажды сделали.

Делая последнее замечание про называние элементов объектами, мы по-прежнему понимаем разницу между самими терминами *объект* и *элемент*. Однако так поступают не все. Иногда *элементы* называют "объектами", потому что сам термин "объект" используется как синоним слова элемент. Хотя мы в этой записи такой терминологии придерживаться не будем, нам придётся иметь дело с редактором JOSM, где она используется. Например, если мы хотим скачать отдельно взятый элемент, в меню редактора нам придётся искать пункт "скачать объект".[^1-object] Особой путаницы в связи с этим возникнуть не должно, поскольку JOSM - редактор осмовских данных, состоящих из *элементов*, *объекты* реального мира скачать и изменить из редактора, конечно, нельзя.

[^1-object]: Можно предположить, что источником такой терминологии являются технологии программирования. JOSM написан на языке программирования Java, который является весьма ориентированным на [объектную парадигму](https://ru.wikipedia.org/wiki/Объектно-ориентированное_программирование), в большей степени, чем C++, Javascript, Python и прочие широко используемые языки. Осмовские элементы, как и многие другие сущности, в исходном коде JOSM представлены в виде "объектов" - уже в том смысле слова "объект", [который используется программистами](https://ru.wikipedia.org/wiki/Объект_(программирование)).

Помимо осмовских элементов и реальных объектов нам придётся иногда рассуждать об *идеальных объектах*. Тут нас ждёт неудобство, потому что часто рассматриваемыми идеальными объектами будут точки и линии - геометрические, а не элементы осма. При этом нам может понадобиться рассуждать одновременно и о геометрических объектах, и об одноимённых элементах. Тогда нам придётся пояснять, о чём именно идёт речь, явно называя точки и линии *геометрическими* или *элементами*.[^1-nodeway] *Линия* является довольно широким понятием, и часто мы будем употреблять более узкие термины. Одним из них будет *прямая*, которой, очевидно, будет идеальный геометрический объект, так как линию бесконечной длины элементом представить нельзя.[^1-ellipse] Словом *отрезок* мы можем называть как идеальный участок геометрической прямой между двумя геометрическими точками, так и участок элемента-линии между двумя элементами-точками. Последний существует даже не как элемент данных, а как элемент интерфейса редактора, являющийся частью представления элемента данных. Так мы обнаружили ещё одно представление чего-то посредством чего-то, но рассуждать дальше на эту тему мы не будем.

[^1-nodeway]: Этого неудобства бы не было, если бы названия элементов *node* и *way* было принято переводить ближе к английскому, например, словами "узел" и "путь". Но в русскоязычных текстах такие варианты перевода практически не встречаются, и не встречаются они и в локализациях интерфейсов ПО, поэтому мы ими не будем пользоваться.

[^1-ellipse]: На то, что на самом деле всё расположено на поверхности эллипсоида, мы совсем не собираемся обращать внимания. Мы будем делать вид, что идеальные объекты располагаются на плоскости.

Постепенно в записи мы будем вводить дополнительные термины для объектов и средств редактирования. Некоторые из них выдуманы мной специально для этой записи, возможно, не слишком удачно. Здесь же можно ещё пояснить, как мы будем называть различные снимки. Делать мы это будем по их наиболее популярным разновидностям, не особо заботясь о корректности названий. Общедоступные наборы снимков, сделанных с уровня земли мы будем иногда называть *панорамами*, даже если они не панорамные. *Спутниковыми снимками* мы будем называть любые снимки сверху, накладываемые на карту, независимо от того, с чего они сделаны.[^1-aerial] Позже мы их поделим на несколько типов. Если мы будем говорить просто *снимки*, то иметь в виду мы будем спутниковые в смысле, обозначенном здесь, а не, например, [street-level](https://wiki.openstreetmap.org/wiki/Street-level_imagery_services).[^1-ortho]

[^1-aerial]: По-английски их наоборот называют *aerial*, то есть воздушные. Там, где летают спутники, воздуха не слишком много, иначе бы спутники упали. Точнее, спутники не летают, а и так падают, только мимо Земли. С воздухом же у них увеличились бы шансы в Землю попасть.

[^1-ortho]: Более заумные термины типа *ортофото* мы особо часто употреблять не будем, потому что нас не интересует процесс получения снимков.
