---
title: Выделение области сдвига
---

## Стандартные способы

Все знают, как в josm выделить элемент. Надо перейти в режим выделения (нажав S), и щёлкнуть левой кнопкой мыши по изображению нужного элемента. Сложнее дело будет обстоять с выделением отношений и выбором одного из нескольких элементов, находящихся на одном и том же месте. Нас, к счастью, эти сложности обычно не касаются. Отношения нам не понадобится выделять вообще. Если исключить их из рассмотрения, то несколько элементов на одном месте - это несколько линий, имеющих общий отрезок. Для решения нашей задачи - перемещения квартала - мы, в принципе, можем обойтись и без выделения линий. Положение линий определяется положением их точек, перемещение линий - это перемещение их точек, а значит, мы могли бы ограничиться лишь выделением точек. Впрочем, ниже, в разделе про landuse, мы коснёмся выбора одной линии из нескольких, но это будет весьма специфическая ситуация, которую мы постараемся не создавать.

Несколько точек на одном месте теоретически возможны, но в готовых осмовских данных, которые мы получим при загрузке определённой области, такое встречается крайне редко. Правда, как выяснится далее, во временных данных, которые мы сами произведём в процессе работы, несколько точек на одном месте оказаться могут. Тем не менее, и сейчас, и потом, задача выбора отдельной точки из нескольких, находящихся на одном месте, перед нами стоять не будет. Вместо неё нам надо решать задачу выбора всех точек, находящихся в определённом месте. В данный момент нас интересует выделение всего, что находится в пределах квартала, и если из двух очень близко расположенных точек нам понадобится выделить одну, вместе с ней нас устроит выделить и другую.

### Последовательное добавление

Один из способов выделения нескольких элементов - их последовательное добавление к выделенному множеству. Чтобы туда добавить элемент, надо кликнуть по нему, удерживая shift. Чтобы убрать из выделения лишний элемент, надо кликнуть по нему, удерживая ctrl. На самом деле ctrl можно использовать и для добавления элемента: если элемент не выделен, то он добавится в выделение, а если выделен, то уберётся. Рассмотренный ранее щелчок без shift или ctrl первым делом очистит множество от всех добавленных в него элементов. В случае, если это действие совершится незапланированно, оно может стать для нас неприятностью: мы лишимся всей проделанной для выделения квартала работы. Чтобы такое произошло, достаточно забыть нажать на shift или просто случайно кликнуть по области редактирования.

Что именно произойдёт при клике можно узнать из формы мышиного курсора. В режиме выделения курсор будет выглядеть как стрелка с пунктирным прямоугольником справа-снизу. Внутри прямоугольника слева будет символ предстоящей операции: плюс при добавлении чего-либо к множеству выделенных элементов, минус при исключении чего-либо из множества или пусто при замене множества на что-либо. Чем является это *что-либо*, можно определить по значку справа внутри прямоугольника. Там будет изображена точка для элемента-точки, отрезок для элемента-линии или пусто для пустого множества элементов. Из этого следует, например, что если прямоугольник совсем пустой, то клик приведёт к полной очистке множества выделения, с чем можно столкнуться при клике мимо изображений элементов без нажатых клавиш.

{% TODO %}картинка: курсоры в режиме выделения{% endTODO %}

Квартал может состоять из сотен элементов, из чего следует, что выделить его последовательным добавлением элементов будет затруднительно. Во-первых, кликать по каждому из них долго, во-вторых неудачный клик может сбросить выделение и заставить начать всё сначала, в-третьих нам будет трудновато кликать отдельно на расположенные очень близко друг к другу элементы, а на расположенные точно на одном месте кликать отдельно не получится вообще. Но даже и без последней трудности нам вряд ли захочется в течение нескольких минут следить за формой курсора или удерживать всё это время на всякий случай shift или ctrl. В принципе, у нас есть средство восстановить случайно сброшенное выделение, и позже мы его рассмотрим, но нам всё равно нужно как-то ускорить процесс выделения и уменьшить количество необходимых для этого операций.

Пока что единственным рассмотренным нами *способом оптимизации* является выделение линии вместо выделения отдельно каждой из её точек. Так выделять мы можем только те линии, которые мы намерены сдвинуть целиком, то есть у которых мы хотим подвинуть каждую их точку. Линии, у которых мы намерены двигать не все точки, тоже будут нам попадаться. Например, при наиболее распространённом способе работы ими будут линии проездов, соединяющие квартал и улицу. Значит, пользоваться таким *способом оптимизации* мы сможем не всегда. Однако даже если мы будем выделять линии каждый раз, когда эта возможность будет доступна, существенно процесс мы не ускорим. Нам всё равно придётся иметь дело с сотнями элементов, а, значит, нам нужны другие средства для их выделения. Если эти средства окажутся слишком грубыми, добавление и исключение отдельных элементов может быть использовано для поправки результата.

### Выделение прямоугольником

Итак, нам нужно средство выделить сразу много элементов, и оно в режиме выделения, вроде бы, есть. Это выделение прямоугольником. Чтобы им воспользоваться, надо поставить указатель мыши в один из углов прямоугольника, нажать левую кнопку, и, удерживая её, протащить указатель до другого угла. Тут можно столкнуться с последствиями того, что режим S, который мы пока называли режимом выделения, позволяет выполнять и другие операции, одной из которых является перемещение. Если под указатель во время нажатия кнопки подвернулось что-то, что josm считает возможным передвинуть, то это и произойдёт, так что готовьтесь это заметить и нажать undo. Ещё в режиме S доступна вставка точки в середину отрезка с её перетаскиванием, так что готовьтесь отменять и эту операцию.

Определить, что произойдёт при нажатии и перетаскивании до того, как нажатие совершено, снова поможет форма мышиного курсора. Для выделения прямоугольником курсор должен иметь уже знакомый нам вид стрелки с пунктирным прямоугольником, внутри которого не должно быть значка точки или линии. Отсутствие этих значков говорит о том, что под курсором нет элементов, которых мы могли бы случайно передвинуть или изменить. Значит, чтобы начать именно выделение прямоугольником, а не другую операцию, курсор перед перетаскиванием надо поставить в окне редактирования на место, не занятое изображениями элементов. Чтобы иметь возможность это сделать, надо, чтобы в окне такое пустое место присутствовало. Чтобы оно присутствовало, часто бывает нужно увеличивать карту, пока промежутки между элементами не станут достаточно большими. Однако, после такого увеличения на экран не поместится весь квартал, что станет одной из причин, по которой его не получится выделить целиком лишь одним прямоугольником.

Теперь настал подходящий момент рассмотреть, как можно выделить квартал прямоугольниками по частям. Эта операция аналогична его выделению по отдельным элементам. Нам точно так же доступны клавиши shift и ctrl для добавления и исключения теперь уже всего находящегося внутри прямоугольных областей. В логике работы клавиши ctrl имеется отличие: теперь она предназначена только для исключения элементов, а не для инверсии.[^6-shiftctrl] Нажимать же клавиши для достижения соответствующего эффекта можно в любой момент перед отпусканием кнопки мыши. На самом деле, это же относится и к операциям над отдельными элементами: значение имеет, какая клавиша нажата в момент отпускания кнопки, потому что именно тогда операция и выполняется, только при клике мы не замечаем разницы во времени между нажатием и отпусканием кнопки. С другой стороны, пока клавиша не будет нажата, курсор не примет отражающий предстоящую операцию вид.

[^6-shiftctrl]: Кстати, если удерживать одновременно и shift, и ctrl, получится совсем иная операция, про которую мы вспомним через несколько разделов, хотя пользоваться ей мы не будем.

Итак, одна из проблем прямоугольного выделения следующая: в масштабе, когда на экран помещается весь квартал, между ним и окружающими его объектами недостаточно пустого места, чтобы начать построение прямоугольника выделения, да и чтобы закончить, не зацепив лишнего - тоже. Но и наличие пустого места нам не слишком бы помогло, ведь чтобы сразу выделить прямоугольником весь квартал, надо, чтобы квартал был тоже прямоугольным. Так бывает часто, но не всегда. Вдобавок к этому нужно, чтобы прямоугольная форма квартала была ориентирована так, чтобы его стороны совпадали с горизонтальными и вертикальными линиями на экране. Эти условия выполнятся, только если нам сильно повезёт, а, значит, имеет смысл поискать другие средства выделения.

{% TODO %}скриншот: Американский Псевдо-Санкт-Петербург, где нам бы сильно повезло{% endTODO %}

### Выделение лассо

В josm помимо режима S, в котором доступно *выделение прямоугольником*, есть похожий режим, в котором доступно *выделение лассо*. Называть мы его будем режимом SS, потому что при использовании клавиатуры для перехода в него нужно, после попадания в режим S с помощью нажатия на клавишу S, повторно нажать на S. Чтобы переключиться в него мышкой через {% help "EditToolbar" %}левый тулбар{% endhelp %}, нужно предварительно включить {% help "ExpertMode" %}режим эксперта{% endhelp %}, иначе соответствующая кнопка на тулбаре отображаться не будет. Режим эксперта лучше включить в любом случае, и в данной записи подразумевается, что так и было сделано. Включить этот режим можно в меню View. Заметим также, что термин *режим* применительно к режиму эксперта обозначает просто опцию josm, а не то, что мы называли и будем называть дальше режимом на протяжении данной записи, то есть *{% menu "Mode#Workingmode" %}рабочий режим{% endmenu %}*. Только что упомянутые S, SS, хорошо известный всем A, а также AA, X, XX и рассмотренный ранее режим параллельных линий - это *рабочие режимы*.

При использовании лассо мы нажимаем левую кнопку на краю области выделения, а дальше перетаскиваем указатель, только теперь перетаскивание идёт не по любому пути к противоположному углу области, а вдоль её контура. Соответственно, форма области теперь произвольная, а не ограниченная прямоугольным видом. Когда кнопка отпускается, контур замыкается по прямой до точки, на которой кнопка была нажата. То есть, надо, удерживая кнопку, обвести нужную область, и её содержимое будет выделено. Точнее, так будет, если мы не изменим работу режима, удерживая клавишу-модификатор.

Так же, как и раньше, нам доступны клавиши shift и ctrl для добавления и исключения областей, хотя курсор при их нажатии не меняется. Так же, как и раньше у нас есть проблемы из-за того, что в режиме SS доступны операции перетаскивания и вставки точки, которые мы можем случайно выполнить вместо выделения. Теперь нет проблем, связанных с тем, что область выделения обязана иметь вид ориентированного прямоугольника, она может быть произвольной формы, зато её контур нужно провести вручную так, чтобы не дрогнула рука. В итоге всё равно придётся увеличить карту настолько, что квартал не поместится на экран. Значит, всё равно придётся выделять квартал по частям, рискуя потерять выделение посреди этого процесса. Должен быть метод получше, и искать нам его придётся за пределами стандартных средств josm.

...
