---
title: Landuse
---

В прошлой главе, где мы [рисовали границу области сдвига](../6-select/#draw-frame), мы заметили, что она уже может существовать в виде {% tag "landuse" %}. Впрочем, подходящего landuse может и не быть, это зависит от этапа эволюции данных и того, по какому пути она пошла. Иногда landuse обозначают ещё до улиц. В этом случае в один landuse будет помещена существенная территория, в которую входят несколько кварталов, или даже весь населённый пункт. Такая картина может сохраниться и до того времени, когда улицы и дома уже будут нарисованы. Для выбора одного квартала такой landuse не годится. В этом случае с landuse лучше дел не иметь, а вместо этого нарисовать свою собственную границу, которую после сдвига нужно будет удалить. Данная глава не про этот случай.

Противоположным ходом событий будет ситуация, когда landuse ещё никто не пытался рисовать, хотя здания и улицы уже добавлены. Действовать при этом можно либо так же, как и в предыдущей ситуации, то есть забыть про landuse, либо рисовать область сдвига из расчёта, что она же как landuse и послужит. В последнем случае landuse создаётся размером с квартал, а не больше и не меньше, что имеет смысл делать в ситуации с уже нарисованными улицами, в которой мы и находимся. Как выяснится, это может быть ещё не конец развития обозначения landuse, далее может происходить его деление на более мелкие части. Этим делением нам, хотящим всего лишь подвинуть квартал, смысла заниматься нет, но стоит удостовериться, не присутствуют ли они в уже введённых данных. Если они есть, то мы можем, опять же, забыть про landuse и рисовать свой полигон, или, как будет сказано ниже, проводить выделение не по одному полигону, а одновременно по нескольким. Также заметим, что под мелкими landuse мы имеем в виду только "настоящие" landuse, то есть {% tag "landuse=residential" %}, {% tag "landuse=commercial" %} и {% tag "landuse=industrial" %}, а не {% tag "landuse=grass" %}, использующийся для рисования газонов.

Если же landuse размером с квартал нарисован, или мы решили его нарисовать, нам может понадобиться обратить внимание на различные слегка отличающиеся способы его расположения. Какой из них был выбран или какой имеет смысл выбрать, зависит от традиций и прочих подобных соображений, разновидности которых можно представить в виде спектра. Одна из крайностей - провести границу landuse по границе улицы. Под улицей тут подразумевается вся её площадь, включающая тротуары. Соответственно, если здания расположены прямо у тротуаров, без промежутка, то граница будет идти прямо по контурам зданий. Если промежуток есть, он обычно заполнен чем-нибудь типа газона или огорожен забором, тогда граница пройдёт по краю этих объектов. Другая крайность - провести границу landuse по границе проезжей части. Также возможны варианты с проведением её где-то между этими крайностями, что обычно и имеет место.

На самом деле указанные крайности - не во всех смыслах крайности. Landuse может в ряде случаев захватывать проезжую часть, а может и не включать в себя здания целиком. Эти случаи являются следствием того, что граница landuse была проведена примерно. Участник, проводивший её, не пытался специально захватить проезжую часть или исключить здания. Ему просто могло быть не видно, где именно проходит граница между тротуаром и проезжей частью, а в данных её часто не бывает, потому что, как мы уже знаем, её рисование является далеко не первым приоритетом. Здания же могут торчать за пределами landuse потому что у них есть выступающие части, которые рисовавший landuse не заметил. То есть, рассмотренные крайности являются таковыми при чётко определённом положении границы. У самой же *чёткости* тоже есть свои крайности.

*Чёткость* проведения границы меняется от проведения её *ровно по необходимому месту* до проведения *неважно где*. Первая крайность подразумевает проведение линий landuse ровно по тем местам, на которых уже есть или должны в принципе оказаться другие линии. Если эти линии уже есть, landuse можно вести через их точки, получая вторую линию поверх уже существующей, или разделяя эти линии на отрезки, которые войдут в отношения мультиполигонов как для введённых ранее объектов, так и для landuse. Если мы хотим провести границу landuse по зданиям, то мы станем включать в неё углы полигонов зданий. Менее понятно, в случае немультиполигонного landuse, захотим ли мы включать в границу точки входов и всё прочее, что уже отмечено на стенах или будет отмечено позже. Зато понятно, что сами здания в нашей ситуации уже нарисованы, так что совмещать линии нам почти наверняка придётся.

Если мы хотим, чтобы граница проходила по краю проезжей части, то линия границы должна будет включать в себя точки, входящие в {% tag "area:highway=*" %}, {% tag "barrier=kerb" %} или во что-либо ещё, проходящее по краю. Обычно ничего из того, что могло бы проходить по краю, ещё не нарисовано, так что проблемы проведения нескольких линий по одному и тому же месту не стоит. Вместо неё стоит проблема выбора точного места для проведения линии. Поскольку мы собирались двигать квартал, лучше не тратить время на точное рисование края проезжей части до сдвига, ведь при квартале, находящемся не на своём месте сделать это будет сложнее. Сначала лучше точно сдвинуть квартал, а точно пририсовать прочее можно позже. Впрочем, есть способ выравнивания и квартала, и всей улицы, в процессе использования которого рисуется и край проезжей части, но он нам может не понадобиться, и до его рассмотрения в этой записи мы не доберёмся.

При проведении границы landuse *неважно где* нам достаточно проследить за парой вещей. Во-первых, здания квартала должны полностью в неё попадать. Исключениями тут будут части зданий, нависающие над улицами, типа арок, которые мы для целей рисования landuse проигнорируем, а для целей сдвига квартала мы разберёмся с ними после сдвига. Во-вторых, линия тротуара вокруг квартала, если она есть, должна либо полностью входить в landuse, либо полностью быть за его пределами. Если этого не сделать, то нам будет сложнее воспользоваться landuse для выбора области сдвига, да и другим участникам такое расположение объектов вряд ли понравится. Особенно неудобно оно при редактировании из [Vespucci](https://wiki.openstreetmap.org/wiki/RU:Vespucci), когда надо пальцем попасть по одной из двух переплетающихся друг с другом линий.

{% TODO %}диаграмма: взгляды на проведение landuse{% endTODO %}

Какой из вариантов проведения границы landuse лучше? К сожалению, однозначного ответа на этот вопрос нет. Правильность конечного результата, снижение зависимости между данными разного типа и масштаба, удобство редактирования - перечисленные цели оказываются несовместимыми. Взгляды на удобство редактирования будут разными у разных участников, пользующихся разными редакторами. Отсюда следует, что если вы выбираете способ нарисовать landuse и у вас нет особых предпочтений - воспользуйтесь местными традициями, то есть нарисуйте его таким же способом, как это было сделано рядом. На случай отсутствия таких традиций, и необходимости самостоятельно выбрать способ рисования landuse, рассмотрим преимущества и недостатки различных способов.

## "Правильный" landuse прямо по зданиям

Какой способ более правилен с точки зрения результата? Тот, который ближе к [генплану города](https://ru.wikipedia.org/wiki/Генеральный_план), на котором отмечено, какой участок имеет какое назначение. Генплан нам нужен не для того, чтобы признать правильным то, что находится в документах вместо того, что есть на самом деле, а для того, чтобы определиться, к какому типу землепользования отнести тротуар и то, что рядом с ним находится. Посмотрев в генплан, мы, скорее всего, увидим такую картину: улица целиком вместе с тротуарами имеет транспортное назначение, а то, что заключено внутренней границей тротуара вокруг квартала имеет уже жилое, коммерческое и прочее подобное назначение. Следовательно, если между зданиями и тротуаром нет заполненного чем-либо другим промежутка, граница landuse должна идти прямо по внешним частям контуров зданий. К сожалению, так проводить границу не совсем удобно.

{% TODO %}на самом деле посмотреть в генплан, мб прихватить картинку{% endTODO %}

Первое неудобство связано с тем, для чего мы обратили внимание на landuse. Сделали мы это для того, чтобы выбрать все элементы квартала. Непосредственно выбирать их неудобно, так как их много. Вместо этого мы решили выбрать один элемент-линию, которая ограничивает область со всем остальным, - это наш landuse - и использовать одну команду из меню. При этом неплохо бы, чтобы и эту одну линию было просто выбрать, а её проще выбрать, когда она нарисована на месте, не занятом другими линиями. Не обязательно, чтобы она полностью находилась на свободном месте, достаточно иметь возможность найти её свободный участок, кликом по которому её можно выбрать. Мы же при правильном по результату методе проводим линию landuse ровно по другим линиям, причём, скорее всего, целиком.

### Стандартный выбор контура { #standard-select-one-of-multiple-ways }

Тут можно сказать, что проявившиеся трудности выбора одного элемента из нескольких на одном месте являются несущественными, что это наши проблемы как редактирующих данные, что в принципе результат важнее удобства редактирования и так далее. Нас, конечно, больше интересуют не причины трудностей или того, что их надо терпеть, а их разрешение, которое мы сейчас и поищем. Выбор одного элемента из нескольких является как раз тем, про который мы ранее сказали, что он нам не понадобится, [за исключением специфической ситуации](../6-select/). В этой специфической ситуации мы и оказались. В ней нам доступны разные варианты действий, среди которых мы сначала рассмотрим стандартные:

* перебор элементов при нажатии и удерживании <kbd>Alt</kbd> и последовательных нажатиях на левую кнопку;
* перебор элементов при последовательных нажатиях на среднюю кнопку;
* выбор элемента из списка нажатием на среднюю кнопку, затем нажатием и удерживанием <kbd>Ctrl</kbd> (на <kbd>Ctrl</kbd> надо нажимать именно *после* средней кнопки), затем кликом левой кнопки по нужному элементу из списка, после чего <kbd>Ctrl</kbd> можно отпустить.

Перебор с <kbd>Alt</kbd> - самый простой вариант, если в месте клика находится небольшое количество элементов, то есть два-три. Проблема может быть в том, что мы не сразу поймём, сколько там элементов всего, и есть ли среди них нужный. Перебор средней кнопкой покажет также список всех элементов, что хорошо, если список поместится на экран, и плохо, если не поместится. Не поместиться он может из-за перечисляемых в нём тегов на элементах. Ещё перебор средней кнопкой неудобен из-за того, что последовательность перебора может сбиться от любого движения мыши.

Если мы захотим выбрать элемент прямо из списка, нам надо в не слишком очевидный момент нажать и держать <kbd>Ctrl</kbd>. Список элементов работает странно, мерцает и пропадает при неверном движении мышью. Из-за тегов он может оказаться слишком длинным, и тогда нужно будет приложить усилия для поиска в нём нужного места, если это место в принципе поместилось на экран. Ещё список позволяет выбрать сразу несколько элементов, чего мы как раз не хотим. В принципе, это не существенная проблема, если в добавок к landuse выберется другой элемент, который мы тоже хотим сдвинуть. Работе команды all inside это помешать не должно, хотя это может нас дополнительно запутать. В целом, список работает так, что пользоваться им не очень приятно.

Есть ещё одно стандартное средство, которое не связано с выбором одного элемента из нескольких, но которое может нам пригодиться. Этим средством является выбор площадного элемента двойным щелчком внутри его площади. Нередко место двойного клика находится внутри сразу нескольких элементов, в случае чего будет выбран самый мелкий из них. Значит, если мы хотим выбрать landuse, нам надо кликать не внутрь здания, газона или парковки. Нам надо найти внутри квартала пустое место и ткнуть туда. Наличие такого места зависит от содержимого квартала в реальности и усердий осмеров по его отрисовке. Теоретически вся внутренняя область квартала может быть покрыта мелкими площадными объектами: зданиями, газонами, {% tag "area:highway" %} или даже просто полигонами с единственным тегом {% tag "surface" %}.[^7-surface] Практически же такое упорное рисование почти никогда не встречается, и пустое место найти реально.

[^7-surface]: Кажется, одного тега {% tag "surface" %} для указания того, чем покрыта область, будет недостаточно. В осме замкнутая линия может означать как линейный объект, так и площадной. Выбор между этими двумя геометриями можно осуществить только по тегам, а surface бывает и у линейных объектов. Значит, за неимением ничего лучшего понадобится ещё тег {% tag "area=yes" %}.

Тут же нам надо вспомнить, что landuse точно по краям других объектов мог быть нарисован мультиполигоном. Мы пока не задавались вопросом, подойдёт ли мультиполигон для команды all inside, и если да, то как его легче выбрать. Ответ на первый вопрос - да, подойдёт. Команда all inside даже правильно отработает *дырки* с inner-границей, так что остаётся вопрос о выборе. В нашем случае *дырок* почти наверняка нет, и причиной существования мультиполигона является необходимость объединить в один элемент несколько линий, образующих внешнюю границу. Для all inside выбирать одну из этих линий бесполезно, потому что она не замкнута. Все линии границы выбирать тоже бесполезно, как мы уже знаем из аналогичной ситуации с линиями тротуаров.

Выбрать надо именно отношение мультиполигона landuse. Вспомнили мы про него именно в этом месте, потому что его можно выбрать двойным кликом как любой другой площадной объект. В общем-то и средства выбора одного объекта из нескольких могут нам помочь. Ещё отношение можно выбрать так:
- отметить сначала любой из его членов, которым в нашем случае будет участок границы;
- найти отношение в окне элемента справа, в списке вхождений элемента в качестве члена;
- выбрать отношение с помощью контекстного меню списка.

### Выбор контура поиском

Мы рассмотрели стандартные средства выбора landuse, которых в большинстве случаев должно хватить. Однако вдруг получилось так, что место для двойного клика не найти, список слишком длинный, да и перебор - тоже. Тогда посмотрим на более хитрые способы выбора нужного нам landuse. Как мы помним, в [JOSM](https://wiki.openstreetmap.org/wiki/RU:JOSM) есть {% action "Search" %}инструмент для поиска и выбора{% endaction %} (*Edit > Search...* в меню или <kbd>Ctrl+F</kbd>). С его помощью мы можем выбрать нужный элемент, не нажимая на него. Вместо этого нам достаточно сделать так, чтобы он был единственным элементом определённого типа, попадающим в окно редактирования. Если нужный landuse - единственный landuse, который виден в данный момент, его можно выбрать по строке `inview landuse`. Ещё есть вариант с попаданием в окно элемента полностью, когда вместо `inview` используется `allinview`, но открыть окно редактирования таким образом будет, скорее всего, сложнее, так как придется отдалится, и в окно попадёт много лишнего. Если в выбор попадают лишние мелочи типа обозначенных с помощью {% tag "landuse=grass" %} газонов, в строке поиска можно заменить `landuse` на `landuse=residential` или другой необходимый тип.

Пытаться показать в окне редактирования определённое место, так чтобы туда не попало лишнего, может быть не слишком удобно. Наверное, это даже менее удобно, чем воспользоваться одним из стандартных методов. Однако у нас есть кое-что, сходное с диалогом поиска, только более подходящее для нашей задачи. Это {% dialog "Filter" %}фильтры{% enddialog %}, которые ранее были рассмотрены как [средство исключения нежелательных элементов из выборки](../6-select/#other-layers). Теперь у нас другая цель: сделать такой фильтр, чтобы временно отображались только landuse, после чего без помех выбрать нужный landuse, а затем отключить фильтр, чтобы выбрать внутренности квартала.

Одна особенность, которую придётся учесть, заключается в том, что фильтр задаёт то, что будет скрыто, а не то, что будет показано. Первой нашей попыткой будет ввести `landuse` в строку поиска, что приведёт к тому, что все landuse будут скрыты. Мы хотим противоположного, для чего нам понадобится воспользоваться не слишком дружественным интерфейсом окна фильтров. У появившегося там фильтра будет два чекбокса слева и один справа. Самый левый чекбокс, который мы уже рассматривали, включает и отключает фильтр - его пометку мы уберём после выбора элемента landuse. Для инверсии фильтра предназначен чекбокс справа от заданной строки поиска, который работает при включённом фильтре. Таким образом, нам нужно проделать следующую последовательность действий: открыть окно фильтров, нажать на Add, ввести строку поиска `landuse` и нажать <kbd>Enter</kbd>. Теперь, когда в окне появился включённый фильтр, надо отметить правый чекбокс, дальше щёлкнуть по линии landuse, и убрать пометку с левого чекбокса. Есть и способ задать инверсию прямо в строке поиска: в ней надо написать `-landuse`, и правый чекбокс трогать уже не понадобится.

{% TODO %}скриншот: окно фильтра{% endTODO %}

Теперь можно снова вспомнить про двойной щелчок для выбора площадного объекта. При включённом фильтре так выбираться будут только прошедшие сквозь фильтр элементы. В итоге способом выбора, требующим наименьшего прицеливания мышкой, будет включение фильтра - двойной щелчок - выключение фильтра. Теперь мы рассмотрели выбор landuse со всех сторон, так что из-за этого не должно возникнуть никакой проблемы даже при "правильном" совмещённом с другими элементами landuse. Если мы от "правильного" варианта расположения landuse откажемся, то по каким-то другим причинам, например, рассматриваемым далее.

### Сложность и охват контура

Далее мы можем заметить, что "правильный" способ рисования landuse приводит к существенному усложнению его контура. Если контур не прикручивать к зданиям, то для типичного четырёхугольного квартала он тоже будет четырёхугольником, то есть в него будут входить только четыре точки. При "правильном" способе мы его прикручиваем, так что в него войдут все углы зданий, выходящие на улицу. Количество углов зависит от того, насколько подробно рисуются контуры зданий. В отношении этого у нас есть определённая свобода выбора, как было рассмотрено в разделе [*Я также вносил уточнения*](../3-counter/#i-did-improvements). Получится, что уточнение формы здания приводит к изменению landuse, а значит этот элемент будет и более сложным, и более часто меняющимся.

Не все из уточнений контуров зданий будет иметь смысл отражать и в landuse. Любая нависающая часть здания, типа [эркера](https://ru.wikipedia.org/wiki/Эркер), по идее, при своём добавлении не должна влиять на landuse. Она ведь не находится на земле, значит землю под ней можно использовать, как будто этой части нет. Если отметить landuse в соответствии с этими соображениями, то для выбора квартала он станет менее пригодным: здания мы хотим выбрать вместе с частями, находящимися за пределами landuse, и эти части нам придётся добавлять вручную. Вместо выбора вручную мы можем попытаться воспользоваться известным нам диалогом поиска.

Например, нужный нам результат может дать добавление к выборке всех линий, у которых выбрана хотя бы одна принадлежащая им точка. Соответствующая строка поиска выглядит так: `type:way parent selected`. Ограничение `type:way` нужно для того, чтобы не зацепить отношений, которые могут быть какими угодно и включать в себя элементы, находящиеся хоть на противоположной стороне Земли. Противоположная сторона Земли у вас, конечно, не загружена, так что её вы случайно не измените, зато у вас может быть загружена противоположная сторона города. Туда вы и не догадаетесь посмотреть, а там может быть выбран магазин одной сети с магазином внутри сдвигаемого квартала, добавленный в [отношение collection](https://wiki.openstreetmap.org/wiki/Relation:collection).

Кстати, при обычном перетаскивании элементов в режиме <kbd>S</kbd>, выделенные отношения остаются на месте. Однако мы можем захотеть воспользоваться для сдвига более хитрой операцией, например скриптом для CommandLine, который уже затронет и все члены выбранных отношений, так что оставлять отношения в выборке опасно. Даже указанная строка поиска не даёт гарантий непопадания лишнего. Например, тоннели метро, о которых [говорилось в предыдущей главе](../6-select/#other-layers), она к выборке добавит целиком, так что "правильный" landuse заставит нас уделять больше внимания правильности выделения элементов, или заставит не пользоваться собой для осуществления этого выделения.

Поскольку мы сказали, что обычное перетаскивание не затрагивает отношение, мы можем снова вспомнить про мультиполигоны. Они тоже являются отношениями, значит перетаскивание не затрагивает и их. Но ведь у нас может быть полно мультиполигонов внутри квартала, и landuse, который мы выбираем до того, тоже может быть мультиполигоном. Не обернётся ли это проблемами? Нет, не обернётся. В [начале главы про выбор](../6-select/) мы вообще сказали, что отношения, а, следовательно, и мультиполигоны нам выбирать не понадобится. Это было сказано из расчёта, что с мультиполигонами landuse мы не возимся, что будет верно для тех читателей, которые пропустили текущую главу. В текущей же главе мы можем уточнить утверждение, сказав, что мультиполигоны не являются конечной целью выбора.

Возможный выбор мультиполигона landuse будет лишь промежуточным этапом, а конечной целью является выбор чисто геометрических элементов точек и линий. Собственно, все рассмотренные нами средства из главы про выбор игнорировали отношения. Это касается и команды all inside, которая при выбранном мультиполигоне сама выберет и его границу, а выбирать непосредственно отношения не станет. У поиска и фильтров другая логика работы, для которой и потребовалось вручную задавать ограничение `type:way`.

Есть нависающие части и поменьше, типа карнизов и краёв крыш. Они рискуют быть включёнными в контур здания, например, при уточнениям по коптерным снимкам. Почему я их не включаю, я уже выше написал, но теперь к этому можно добавить ещё одну причину: за пределами landuse будут находиться участки контуров всех зданий, находящихся прямо у улицы. Тем не менее, способ рисования, включающий в здание всё, что торчит за линией основания, может в будущем победить. Так получится если станут широко доступны снимки высокого разрешения, и у участников будет желание обозначать мелкие части зданий. Можно надеяться, что в этом будущем рассматриваемая в данной записи операция сдвига станет неактуальной, хотя перед его наступлением у уточнятелей есть шансы подпортить данные.

Допустим, что будущее ещё не наступило, и мы проводим "правильный" landuse по границам зданий. Помимо точек, задающих форму зданий, то есть углов, на контурах бывают ещё точки, соответствующие аркам, входам и всему, что закреплено на стенах типа почтовых ящиков. Следует ли и их включать в контур landuse? Будут ли это делать другие участники, отмечающие подобные объекты при уже обозначенном landuse? Придаём ли мы смысл включению или невключению таких объектов в различные линии? Какой смысл в принципе может быть для входов, показано в записи [Как я отмечаю POI – Геометрия](https://www.openstreetmap.org/user/Anton%20Khorev/diary/45247), а в более общем случае этот вопрос должен был рассматриваться в следующей записи из этой серии.[^7-next-poi-diary] Там же должен был рассматриваться и вопрос о том, стоит ли в принципе привязывать landuse к физическим объектам, у чего есть как преимущества, так и недостатки. Сторонники отмечать landuse мультиполигонами вынуждены отвечать на эти вопросы определённым образом, а именно *следует привязывать/включать и не придавать включению смысла*. С таким ответом можно, скорее, не согласиться, так как, например, вход в здание это не вход в landuse, а смысл у включения входов в линии есть. Другое дело - убедить в этом остальных, особенно в тех местах, которые вы сами редактировать не собираетесь.

[^7-next-poi-diary]: Эта следующая запись была отложена, чтобы написать данный текст про сдвиг квартала, который тоже планировался как запись в дневние и тоже был отложен, чтобы... не помню, чтобы что.

Наши соображения о правильности включения неугловых точек могут вступить в конфликт с нашими целями выделения квартала, ради которых мы и рассматриваем landuse в данной записи. Если наши цели не изменились, при том, что мы хотим проводить границу landuse прямо по зданиям, соображения нам удобнее поменять. Неугловые точки, не включённые в landuse, могут оказаться чуть-чуть снаружи его, и команда All inside их не выберет. Такие оказавшиеся за пределами landuse точки заметить сложнее всего. До применения All inside их вообще нереально заметить. В итоге, помимо геометрической правильности обнаружилась ещё и правильность соединения элементов, топологическая правильность. Мы ещё столкнёмся с этим различием, и мы решим, что рассматриваемая нами задача в первую очередь геометрическая. Подходы к редактированию, добавляющие топологических проблем, доя нас не слишком удобны.

## Отход от "правильного" landuse

Большинство участников не станут лишний раз использовать мультиполигоны, и обычно никого не нужно убеждать включать или не включать в landuse отдельные точки, так как сам "правильный" метод обозначения landuse популярностью не пользуется. Незначимые мелочи в контуре landuse и прочие проблемы наводят на мысль, что от проведения границы landuse точно по зданиям удобнее отойти. Следующий вопрос в том, насколько далеко имеет смысл отойти. Чем дальше мы отойдём, то есть чем дальше от зданий мы проведём линию landuse, тем меньше у нас будет проблем, но тем менее "правильным" станет результат.

Понятно, что отходить дальше мы можем только до определённого предела, пока наш landuse не пересечётся с landuse на противоположной стороне улицы. Этим пределом будет середина улицы, по которой обычно проводится соответствующая линия highway. Несмотря на это, выше мы объявили крайностью линию границы проезжей части. Сделано это было потому, что в реальности за неё далеко выходить не пытаются. В принципе мы допускали выход за эту крайность при неполной *чёткости*. При полной чёткости следующим кандидатом на крайность была бы как раз середина улицы, но попыток такого обозначения landuse я не видел. Если бы они производились, край landuse пришлось бы совмещать не только с highway и всем, что уже совмещено с highway, но и с противоположным landuse. Этим участники, видимо, заниматься не хотят.

Если мы забудем про "правильность" landuse вообще, и будем руководствоваться только удобством редактирования, то дополнительную линию лучше всего провести по наиболее свободному от прочих данных месту. В нашем случае таким местом будет промежуток между серединой улицы и тротуаром. В этом промежутке и находится граница проезжей части. Как мы знаем, обычно она в осмовских данных не представлена, так что проблем пересечения landuse с другими данными при проведении его контура в этом месте не будет. С другой стороны, эта граница является визуальным ориентиром для проведения линии по спутниковому снимку. Этот ориентир виден ещё лучше, чем линия основания зданий, чем мы могли бы воспользоваться для выравнивания улицы и зданий.

Так получается внешняя крайность при проведении линии landuse в определённом месте: при отсутствии в данных границы проезжей части удобнее всего провести landuse именно здесь.[^7-border] Если же граница в данных есть, то удобнее всего провести landuse между ней и серединой улицы, так как именно там будет наиболее свободное место. В этом случае у нас уже нет ориентира для проведения линии, и проводим мы её не по достаточно строго определённому месту. Соответственно, она выходит за *чёткую* крайность.

[^7-border]: [Пример мнения](https://community.openstreetmap.org/t/landuse-residential/126898/4), что так и надо делать.

В реальности проведение по границе проезжей части встречается, а выход за неё, как уже было сказано, происходит гораздо реже. Видимо, все понимают, что так landuse будет слишком далёк от "правильного" варианта. Но он также достаточно далёк и при проведении по границе, что делает популярными способы рисования landuse в пределах площади тротуара. Можно выделить три таких способа: в упор к зданиям, между зданиями и линией тротуара, между линией тротуара и границей проезжей части. Если линию тротуара никто не провёл, то последние два способа превращаются в один.

Первый способ подразумевает проведение линии landuse в сантиметрах от зданий. При нём у нас сохраняется максимум проблем от проведения линии прямо по зданиям, и даже добавляются новые. Проблема ткнуть в нужную линию ослабляется, но не настолько, насколько это было бы при её проведении по более свободному месту. Через каждый угол каждого здания линию вести не нужно, зато некоторые из углов могут оказаться за пределами landuse, что останется незамеченным для того, кто landuse рисовал. Заметить это придётся перед выполнением сдвига, о чём мы уже [знаем из главы про выделение](../6-select/#wrong-frame). Углы, торчащие, потому что они криво нарисованы, присоединятся к торчащим частям зданий, которые торчат на карте, потому что они торчат в реальности. Последних нам придётся либо так и оставить торчать, либо обрисовывать вокруг них границу landuse. Прочие не задающие форму точки на контурах зданий, вроде бы, проблемой не являются. На самом деле, проблем нет с уже введёнными точками, а те, которые будут введены, могут быть введены с проблемами. Участнику надо будет постараться попасть в линию здания, а не в находящуюся рядом с ней линию landuse, что удастся сделать не всем и не всегда. Типичной картиной являются арки и проезды через них, начинающиеся от landuse, а не от здания. Особенно легко попасть не в ту линию, когда местами торчат углы, и линии зданий и landuse переплетаются. В общем, если мы хотим меньше проблем, то этот способ не для нас.

При двух оставшихся способах линия landuse проводится на расстоянии от нескольких дециметров до нескольких метров. Такое расстояние избавляет нас от большинства описанных выше проблем, но при этом мы отдаляемся от "правильного" положения landuse. У нас остаётся выбор захватить или не захватить линию тротуара, который легко разрешить, если эта линия аккуратно проведена. В этом случае мы её захватывать не будем, чтобы быть ближе к "правильному" положению. Другое дело, что аккуратности может и не быть. В нашей ситуации её и не следует ожидать, ведь мы решили, что весь квартал находится не на месте, тогда и тротуар, скорее всего, нарисован кое-как. Часто так и есть, и для того, кто хочет рисовать тротуары, но не готов двигать кварталы, это логичный способ действий. Тогда может оказаться, что местами линия тротуара находится слишком близко к зданиям, и, попытайся мы провести границу landuse между ней и зданием, обнаружатся неудобства первого способа.

Какие имеются варианты действий при кривом тротуаре, внутри которого сложно провести границу landuse? Можно провести границу снаружи, хотя тротуар может быть настолько кривым, что и этого делать не захочется. Тогда можно не рисовать landuse, а задать временный полигон для выбора квартала. Так бы и имело смысл поступить, но с тротуаром всё равно может понадобиться разобраться. Он может быть нарисован так, что его нельзя ни оставить на месте, так как он перекроется сдвинутыми зданиями, ни сдвинуть, так как он будет слишком торчать после сдвига. Если вдобавок к этому и сами здания вдоль улицы криво нарисованы, или также криво проведена сама улица, то может захотеться перевыровнять все линии, параллельные улице,[^7-redraw] и заодно с этим нарисовать новый landuse. Правда landuse этот придётся создавать уже после сдвига, а значит временный полигон рисовать придётся, но тогда это уже не будет относительно большой проблемой, так как временных линий и без него будет штук десять.

[^7-redraw]: Это всё тот же трудоёмкий способ, который мы в данной записи не рассматриваем. Упомянутое выше использование границы проезжей части в качестве ориентира как раз и нужно для этого способа.

Итак, какой способ следует выбрать нам? Как уже было сказано, лучше выбрать тот, который используется в местах поблизости. Если поблизости ничего подходящего для руководства нет, то при не слишком кривой геометрии зданий и тротуаров я провожу границу landuse в полуметре от зданий. Так я поступаю для того, чтобы граница была не слишком близко к зданиям, а также потому, что полметра это шаг, используемый по умолчанию в режиме проведения параллельных линий. В этом режиме я создаю временные линии вокруг угловых зданий квартала, чтобы на фиксированном расстоянии от них получить точки, через которые уже и проводится граница. Позже, если возникнет необходимость, от этого способа можно перейти к "правильному" расположению landuse с помощью того же режима. Для этого уже внутри линии нашего "неправильного" landuse нужно на полуметровом расстоянии провести параллельную линию, после чего первую линию следует заменить свежепроведённой второй с помощью команды replace geometry.

В общем, landuse лучше рисовать способом, при котором можно думать поменьше, где именно провести линию, так как наша задача - сдвинуть квартал, а размышления о правильной линии нас от решения задачи отвлекают. Даже в этой записи, возможно, не стоило отвлекаться на эту тему, но уже поздно останавливаться. Нам придётся даже продолжить и рассмотреть ещё один момент.

## Несколько landuse

То, что было сказано выше, относилось к случаю, когда один полигон landuse покрывает весь квартал. Объясняется это тем, что мы и хотели такой полигон для выделения данных, а также тем, что часто landuse так и отмечен. Иногда же бывает и по-другому. Представим себе такую ситуацию. Осмер смотрит на квартал, видит там заводы, склады и подобное и относит его целиком к промзоне, рисуя вокруг всего квартала {% tag "landuse=industrial" %}. Другой осмер смотрит на тот же квартал и видит там офисы, решает что офисам внутри {% tag "landuse=industrial" %} находиться не положено и удаляет landuse. Ясно, что цикл отмечания и удаления landuse можно повторять здесь сколько угодно раз. Это, кстати, реальная ситуация, и возникать она может очень часто, так как переоборудование под бизнес-центры бывших промышленных зданий - распространённое явление.

Как нам выйти из цикла? Можно, например, отметить территорию бизнес-центра как {% tag "landuse=commercial" %}, а территорию действующих промобъектов - как {% tag "landuse=industrial" %}. Это хорошее решение, только для целей данной записи нам нужен был полигон, покрывающий квартал, в качестве которого мы могли использовать landuse. Теперь же у нас два полигона, и ни один из них весь квартал не покрывает. На самом деле, ничего страшного в этом нет, просто перед использованием команды all inside нужно будет выделить не один элемент landuse, а два. Два полигона landuse это, конечно, не предел, но и больше десяти их, скорее всего, не будет, так что вручную понадобится выбрать ограниченное количество объектов. Поскольку теперь нам может понадобиться выделить несколько полигонов, мы можем задуматься, все ли способы их выделения подойдут. Сомнения у нас могут быть на счёт двойного щелчка. Выясняется, что модификаторы <kbd>Shift</kbd> и <kbd>Ctrl</kbd> работают и с ним, так что способы подойдут.

Если квартал покрыт не одним, а несколькими landuse, то их границы проходят внутри квартала. Выше мы рассматривали, где именно могут проходить границы landuse, и что из этого следует, но это относились только к участкам контуров landuse вне кварталов. Теперь у нас есть участки, идущие внутри, и для них нам тоже надо решить, где именно их провести. Допустим, у нас есть два здания, которые стоят не вплотную друг к другу, и участки рядом с ними принадлежат разным landuse. Тогда граница этих landuse проходит где-то между зданиями, и мы без проблем можем провести такую линию.

Однако тот факт, что у участков разное назначение часто выражается в наличии между ними забора. В этом случае линия уже есть, и надо выбрать, как относительно неё провести границу. В случае с границей вне квартала мы обычно отодвигали границу наружу на небольшое расстояние, чтобы не вести её по уже существующим линиям. В случае, который мы рассматриваем сейчас, мы сможем так поступить, если придумаем, какая сторона является наружной. У забора две стороны, и отодвигая границу в ту или иную сторону, мы включаем его в тот или иной landuse. Какой из этих вариантов правильный и есть ли вообще среди них правильный вариант?

Мы можем попробовать разрешить этот вопрос, определив, кому принадлежит сам забор. Например, если он ограничивает участок какого-то предприятия, то, вероятно, он предприятию и принадлежит. Тогда, если забор находится на границе {% tag "landuse=residential" %} и {% tag "landuse=industrial" %}, его можно поместить внутрь industrial. Примерно так же можно поступить и в случае residential и commercial. В более общем случае забор можно отнести к тому участку, на который труднее попасть.

Рассмотренный принцип не поможет сделать выбор для забора на границе  landuse для двух предприятий. Иногда такую границу создают, даже если тип landuse по обе стороны от неё одинаковый. Для соседствующих landuse при этом могут быть указаны разные названия и контактные данные, выяснение которых могло являться побочным эффектом от определения типа landuse. Кто именно хозяин забора в этом случае установить может не удаться. Забор также может идти от здания внутри одного landuse до здания внутри другого. Решимся ли мы вместе с территорией у забора отрезать в пользу одного из landuse часть одного из зданий? Наконец, между зданиями в разных landuse пространства может и не быть, тогда уж точно часть здания придётся заносить в чужой для неё landuse.

Решать, в чью пользу подвинуть границу landuse не понадобится, если мы не постесняемся её провести по уже существующим линиям. Конечно, при этом мы получим часть проблем, от которых мы и отделывались, не ведя границу по линиям, но таких проблем теперь будет меньше. Вряд ли эркер жилого дома будет висеть над промзоной. Вряд ли и вход в дом будет прямо на границе landuse. Если получилось именно так, то это повод задуматься о том, правильно ли установлена граница. Почтовых ящиков и подобных им объектов на стене-границе внутри квартала тоже будет гораздо меньше. То есть лишних усложнений на границах по линиям внутри квартала мы ожидаем увидеть меньше, чем по линиям снаружи.

Что касается заборов - проведём границу прямо по ним. Мы бы так и поступили, если бы забор нарисован не был. Нередко так и получается, и {% tag "barrier=fence" %} добавляется уже после раздела landuse, потому что внутриквартальная разведка проводится позже. При проведении границы по забору возможны неприятности, если забор из глубины квартала выходит на улицу, поворачивает и продолжается вдоль неё. Вдоль улицы у нас гораздо больше причин не вести границу прямо по забору, значит, граница должна с него в месте выхода на улицу соскочить. Насколько это плохо, можно поспорить. Я лично считаю, что лучше рисовать так, чем приклеивать границу вдоль улицы к забору при наличии забора, но не приклеивать её к зданиям. Отказ же от приклеивания и внутри квартала обычно даёт более корявый результат, когда границы landuse слабо согласуются с геометрией физических объектов.

Способ отмечать границы landuse на расстоянии от введённой геометрии снаружи квартала и точно по ней внутри целям выделения квартала ради сдвига не помешает. Главное, чтобы между отдельными кусками landuse не было расстояния, внутри которого может оказаться какая-нибудь точка из тех, которые мы собираемся двигать. Для этого надо, чтобы у смежных участков границ внутри квартала все точки входили как в одну линию landuse, так и в другую. Это пригодится даже если мы не решимся вести границы внутри по существующей геометрии.

Напоследок отметим ещё одно явление, наблюдающееся, когда landuse уже нарисован до нас. Иногда он рисуется совсем независимо от объектов типа зданий, или наоборот, объекты рисуются независимо от landuse. Иногда это делается по разным смещениям, и часть квартала оказывается за пределами landuse. Понятно, что воспользоваться landuse для выделения квартала в этом случае не получится. Landuse лучше до сдвига квартала вообще не трогать, так как правильное смещение может быть как раз у него. Придётся рисовать временный полигон для выделения квартала, из которого надо не забыть исключить точки landuse, которые туда обязательно попадут. После сдвига квартала выяснится, надо ли двигать и landuse, хотя может оказаться, что его лучше целиком перерисовать.
